<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IBCG APP - Liturgia 2025 (Ciclo C)</title>
    <!-- Favicon para Navegadores y Accesos Directos en M√≥viles -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EüïäÔ∏è%3C/text%E3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EüïäÔ∏è%3C/text%E3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html-docx-js/dist/html-docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
<style>
        @import url('https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400&family=Roboto:wght@400;500;700&display=swap');
        body {
            font-family: 'Merriweather', serif;
            background-image: url('https://www.bibleserver.com/build/bs-start-back-Dno9hVpC.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #433A3F; 
        }
        h1, h2, h3, h4, h5, h6, .nav-item, .filter-button, .main-nav-button {
            font-family: 'Roboto', sans-serif;
        }
        .liturgy-text {
            transition: all 0.3s ease-in-out;
            border-left: 4px solid transparent;
            padding-left: 1rem;
            margin-top: 1rem;
            line-height: 1.7; /* Slightly adjusted line height */
            font-size: 0.9rem; /* Base font size for mobile */
        }
        @media (min-width: 768px) {
            .liturgy-text {
                font-size: 1rem; /* Larger font size for desktop */
            }
        }
        #main-header {
            transition: transform 0.3s ease-in-out;
        }
        .header-hidden {
            transform: translateY(-100%);
        }
        .ref-link {
            cursor: pointer;
            font-weight: bold;
            /* The text color of the word itself is inherited */
            text-decoration: none;
            position: relative;
        }
        .ref-link sup {
            font-size: 0.7em;
            vertical-align: super;
            margin-left: 1px;
            font-weight: 900;
            color: #dc2626; /* red-600 */
        }
        
        /* --- Mobile-Optimized Popup/Modal Styles --- */
        #theology-popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(2px);
            z-index: 100;
        }
        #theology-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Center the popup */
            width: 90%;
            max-width: 450px; /* Slightly wider for more content */
            max-height: 80vh; /* Prevent it from being too tall */
            overflow-y: auto; /* Allow scrolling within the popup */
            background-color: white;
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            z-index: 110;
            font-family: 'Merriweather', serif;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #334155;
        }
        #theology-popup h5 {
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            color: #0d9488;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }
        #theology-popup .original-term {
            font-size: 1.5rem;
            font-family: 'Times New Roman', serif;
        }
        #popup-close {
            position: absolute;
            top: 0.5rem;
            right: 0.75rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #94a3b8;
            cursor: pointer;
            line-height: 1;
        }
        #popup-close:hover { color: #475569; }
        
        /* Full Screen Liturgy View Styles */
        #full-liturgy-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #FDFBF5; z-index: 100; overflow-y: auto;
        }
        .liturgy-section h2 {
            font-size: 1.25rem; /* Reduced for mobile */
            font-weight: 700; border-bottom: 2px solid #fBBF24; padding-bottom: 0.5rem; margin-bottom: 1.5rem; margin-top: 2.5rem; color: #1e293b;
        }
        .liturgy-section h3 {
            font-size: 1rem; /* Reduced for mobile */
            font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.5rem; color: #334155;
        }
        @media (min-width: 768px) {
            .liturgy-section h2 { font-size: 1.5rem; }
            .liturgy-section h3 { font-size: 1.1rem; }
        }

        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Splash Screen */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background-image: url('https://images.unsplash.com/photo-1489664942048-a3a60914a2f4?q=80&w=2070&auto=format&fit=crop');
            background-size: cover; background-position: center;
            z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; text-align: center;
            transition: opacity 1.5s ease-in-out;
            padding: 1rem;
        }
        #splash-screen.fade-out {
            opacity: 0;
        }
        .splash-title {
            font-family: 'Merriweather', serif;
            font-size: 2.5rem; sm:font-size: 3rem; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .splash-subtitle {
            font-family: 'Roboto', sans-serif;
            font-size: 1.1rem; sm:font-size: 1.25rem; margin-top: 0.5rem; text-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }

        /* Main Menu */
        .main-nav-button {
            padding: 0.5rem 0;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #4b5563; /* gray-600 */
            transition: all 0.2s ease-in-out;
            font-size: 0.875rem; sm:font-size: 1rem;
        }
        .main-nav-button:hover {
            color: #0d9488; /* teal-600 */
            border-bottom-color: #99f6e4; /* teal-200 */
        }
        .active-nav {
            color: #0f766e; /* teal-700 */
            font-weight: 700;
            border-bottom-color: #0f766e; /* teal-700 */
        }
        
        /* Liturgical Cards Styles */
        .liturgical-card {
            background-color: white;
            border-left-width: 6px;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .liturgical-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        /* Mobile Menu Transition */
        .menu-hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* New Lectionary Styles */
        #lectionary-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        #month-selector {
            @apply px-4 py-2 text-base font-medium text-gray-700 bg-white rounded-md shadow-sm border border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500;
        }
        #current-month-year {
            font-size: 1.5rem;
            font-weight: bold;
            color: #374151;
        }
        .lectionary-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            text-align: center;
        }
        .calendar-header {
            font-weight: bold;
            color: #4b5563; /* gray-600 */
            padding-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        .calendar-day {
            padding: 0.5rem;
            cursor: pointer;
            border-radius: 9999px;
            transition: background-color 0.2s, color 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1 / 1;
        }
        .calendar-day:not(.empty):hover {
            background-color: #f0fdfa; /* teal-50 */
            color: #0f766e;
        }
        .calendar-day.is-sunday .day-number {
            color: #0f766e; /* teal-700 */
        }
        .day-number {
            font-size: 1rem;
            font-weight: 500;
        }
        .day-name {
            font-size: 0.75rem;
            color: #6b7280;
        }
        .calendar-day.has-data {
            position: relative;
        }
        .calendar-day.has-data::after {
            content: '';
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background-color: #14b8a6; /* teal-500 */
        }
        .calendar-day.empty {
            cursor: default;
            pointer-events: none;
        }
        #lectionary-popup-close {
            font-size: 2rem;
            line-height: 1;
        }
        .office-section h5 {
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            margin-top: 1.25rem;
            margin-bottom: 0.25rem;
            color: #334155;
            font-size: 1rem;
        }
        .office-section .liturgy-text {
            border-left: none;
            padding-left: 0;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }


        /* Print Styles */
        .print-only-header { display: none; }
        @media print {
            @page {
                size: letter landscape;
                margin: 1cm;
            }
            body, html { background-color: white !important; }
            body > *:not(#full-liturgy-view) { display: none; }
            #full-liturgy-view {
                position: static; width: auto; height: auto; overflow: visible; background-color: white !important;
            }
            #full-liturgy-header { display: none; }
            .print-only-header { display: block; text-align: center; margin-bottom: 1cm; break-after: avoid; }
            .print-title { font-size: 16pt; font-weight: bold; font-family: 'Times New Roman', Times, serif; }
            .print-subtitle { font-size: 12pt; font-style: italic; font-family: 'Times New Roman', Times, serif; }
            #full-liturgy-content { padding: 0; margin: 0; }
            .print-liturgy-body { column-count: 2; column-gap: 1.5cm; }
            .liturgy-section { break-inside: avoid; }
            .liturgy-section h2 { font-size: 14pt !important; color: black !important; border-bottom: 2px solid black; break-after: avoid; padding-top: 1em; }
            .liturgy-section:first-of-type h2 { padding-top: 0; }
            .liturgy-section h3 { font-size: 11pt !important; color: black !important; }
            body, .liturgy-text, p { font-family: 'Times New Roman', Times, serif; font-size: 10pt !important; color: black !important; background-color: white !important; }
            .ref-link { display: none; }
            #full-liturgy-content .bg-white { box-shadow: none; padding: 0; }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="menu-hidden fixed inset-0 bg-white z-50 flex flex-col items-center justify-center transition-opacity duration-300 ease-in-out">
        <button id="close-menu-btn" class="absolute top-5 right-5 text-gray-600 hover:text-gray-900 p-2">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
        <nav id="mobile-nav-links" class="flex flex-col items-center gap-8">
            <a data-view="home" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Inicio</a>
            <a data-view="liturgy" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Liturgia</a>
            <a href="https://www.bibleserver.com/es/NVI/G%C3%A9nesis1" target="_blank" rel="noopener noreferrer" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600">Biblia</a>
            <a data-view="glossary" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Libro de Oraci√≥n Com√∫n</a>
            <a data-view="lectionary" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Leccionario</a>
            <a href="https://www.bibleserver.com/nicodemus-ai" target="_blank" rel="noopener noreferrer" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600">Nicodemus IA</a>
        </nav>
    </div>

    <div id="splash-screen">
        <h1 class="splash-title">Comunidad de Gracia</h1>
        <p class="splash-subtitle">Liturgia y Recursos</p>
    </div>

    <div id="main-content" class="opacity-0 transition-opacity duration-500">
        <header id="main-header" class="bg-white/80 backdrop-blur-sm shadow-sm py-2 px-4 sticky top-0 z-20">
            <div class="container mx-auto flex justify-between items-center">
                <!-- Logo and Title -->
                <div class="flex items-center gap-3">
                    <img id="logo-image" src="https://scontent-mia3-1.xx.fbcdn.net/v/t39.30808-1/458442022_122107426106496454_2577487987417874050_n.jpg?stp=dst-jpg_s200x200_tt6&_nc_cat=111&ccb=1-7&_nc_sid=2d3e12&_nc_ohc=Zy1TV0kujjIQ7kNvwEz8bgt&_nc_oc=Adl4Yh0O1zq-mS8LlfMHzCmTKgBM-yzBhJyyNVnQtxBS9eQMVoKdbqWamxJjkk23f78&_nc_zt=24&_nc_ht=scontent-mia3-1.xx&_nc_gid=AuKzGmho4nnugwzcXEAx7A&oh=00_AfQLVtVuH2tLlf7fZE-otz8oogECgeQlPogoM7mnCAewGA&oe=68938DFE" onerror="this.onerror=null;this.src='https://placehold.co/100x100/3A5F7D/FFFFFF?text=Logo';" alt="Logo Comunidad de Gracia" class="h-10 w-auto rounded-full">
                    <h1 class="text-lg sm:text-xl font-bold text-gray-800">IBCG APP</h1>
                </div>
                <!-- Desktop Navigation Buttons -->
                <nav class="hidden lg:flex flex-wrap justify-center items-center gap-x-3 sm:gap-x-4 md:gap-x-6">
                    <a id="btn-home" class="main-nav-button cursor-pointer">Inicio</a>
                    <a id="btn-liturgy" class="main-nav-button cursor-pointer">Liturgia</a>
                    <a href="https://www.bibleserver.com/es/NVI/G%C3%A9nesis1" target="_blank" rel="noopener noreferrer" class="main-nav-button">Biblia</a>
                    <a id="btn-glossary" class="main-nav-button cursor-pointer">Libro de Oraci√≥n Com√∫n</a>
                    <a id="btn-lectionary" class="main-nav-button cursor-pointer">Leccionario</a>
                    <a href="https://www.bibleserver.com/nicodemus-ai" target="_blank" rel="noopener noreferrer" class="main-nav-button">Nicodemus IA</a>
                    <a id="btn-upload-logo" class="main-nav-button cursor-pointer">
                        <svg class="w-6 h-6 text-gray-600 hover:text-teal-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    </a>
                </nav>
                <!-- Mobile Menu Button -->
                <div class="lg:hidden flex items-center">
                    <button id="hamburger-btn" class="p-2 rounded-md text-gray-600 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-teal-500">
                        <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <input type="file" id="logo-uploader" class="hidden" accept="image/*">

        <div id="home-view" class="min-h-[85vh]">
            <!-- This div is intentionally empty to show the body background -->
        </div>

        <div id="liturgy-view" class="hidden">
            <main class="container mx-auto p-4">
                <div class="bg-white/80 backdrop-blur-sm p-4 sm:p-6 rounded-lg shadow-2xl">
                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 text-center border-b-2 border-amber-400 pb-3">Calendario Lit√∫rgico 2025</h2>
                    <div id="liturgical-cards-container" class="space-y-4">
                        <!-- Liturgical cards will be inserted here by JavaScript -->
                    </div>
                </div>
            </main>
        </div>

        <div id="glossary-view" class="hidden">
            <main class="container mx-auto p-4 md:p-8">
                <div class="bg-white/80 backdrop-blur-sm p-6 sm:p-8 rounded-lg shadow-lg">
                    <h2 class="text-2xl sm:text-3xl font-bold border-b-2 border-amber-400 pb-2 mb-6 text-gray-800">Libro de Oraci√≥n Com√∫n (2019)</h2>
                    <div class="mt-8 text-center bg-stone-100 p-6 sm:p-8 rounded-lg shadow">
                        <p class="text-lg text-gray-700 mb-4">Para acceder a los recursos del Libro de Oraci√≥n Com√∫n, por favor haz clic en el siguiente bot√≥n. El sitio se abrir√° en una nueva pesta√±a del navegador.</p>
                        <a href="https://bcp2019.anglicanchurch.net/index.php/downloads-espanol/" target="_blank" rel="noopener noreferrer" class="inline-block bg-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-700 transition-colors shadow-md">
                            Ir a Recursos ACNA
                        </a>
                    </div>
                </div>
            </main>
        </div>

        <div id="lectionary-view" class="hidden">
            <main class="container mx-auto p-4 md:p-8">
                <div class="bg-white/80 backdrop-blur-sm p-6 sm:p-8 rounded-lg shadow-lg">
                    <h2 class="text-2xl sm:text-3xl font-bold border-b-2 border-amber-400 pb-2 mb-6 text-gray-800">Oficio Diario - Leccionario (A√±o Uno)</h2>
                    <div id="lectionary-controls">
                        <h3 id="current-month-year"></h3>
                        <select id="month-selector"></select>
                    </div>
                    <div id="lectionary-day-grid-container"></div>
                </div>
            </main>
        </div>
        
        <footer class="bg-gray-800/90 text-white py-6 px-4">
            <div class="container mx-auto text-center">
                <p>&copy; 2025 IBCG APP. Todos los derechos reservados.</p>
                <p class="text-sm text-gray-400 mt-2">Textos lit√∫rgicos del Misal Romano. Textos b√≠blicos de la Conferencia Episcopal Espa√±ola.</p>
            </div>
        </footer>
    </div>

    <div id="full-liturgy-view" class="hidden">
        <header id="full-liturgy-header" class="sticky top-0 bg-white/95 backdrop-blur-sm shadow-md z-10">
            <div class="container mx-auto flex items-center justify-between p-2 sm:p-4">
                <button id="back-to-calendar-btn" title="Volver al calendario" class="flex-shrink-0 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    <span class="hidden sm:inline font-semibold text-base">Volver</span>
                </button>
                <div class="flex-grow text-center min-w-0 px-2">
                    <h1 id="full-liturgy-title" class="text-sm sm:text-base md:text-lg font-bold text-gray-800 truncate"></h1>
                    <p id="full-liturgy-subtitle" class="text-xs text-gray-600 truncate"></p>
                </div>
                <div class="flex-shrink-0 flex items-center gap-2 sm:gap-4">
                    <button id="download-docx-btn" title="Descargar como DOCX" class="text-gray-600 hover:text-gray-900 transition-colors p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                    </button>
                    <button id="print-btn" title="Imprimir Liturgia" class="text-gray-600 hover:text-gray-900 transition-colors p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                    </button>
                </div>
            </div>
        </header>
        <main id="full-liturgy-content" class="container mx-auto p-4 md:p-8">
            
</main>
    </div>

    <!-- Popups -->
    <div id="theology-popup-overlay"></div>
    <div id="theology-popup">
        <span id="popup-close">&times;</span>
        <div id="popup-content-theology"></div>
    </div>

    <div id="lectionary-popup-overlay" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-40 transition-opacity duration-300"></div>
    <div id="lectionary-popup" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-11/12 max-w-2xl bg-white rounded-lg shadow-2xl z-50 max-h-[90vh] flex flex-col transition-transform duration-300 scale-95">
        <header class="flex items-center justify-between p-4 border-b flex-shrink-0">
            <h3 id="lectionary-popup-title" class="text-lg font-bold text-gray-800"></h3>
            <button id="lectionary-popup-close" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button>
        </header>
        <div id="lectionary-popup-body" class="p-6 overflow-y-auto">
            <!-- Readings will be injected here -->
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- HELPER FUNCTIONS ---
            const addDays = (d, days) => { const res = new Date(d); res.setDate(d.getDate() + days); return res; };

            // --- THEOLOGICAL DATA & HELPERS (GLOBAL SCOPE) ---
            const terms = {
                // Terms for Liturgy
                hypostasis: {original: "·ΩëœÄœåœÉœÑŒ±ŒπœÇ", transliteration: "hyp√≥stasis", meaning: "Sustancia, fundamento, garant√≠a. En este contexto, la fe es la realidad fundamental de lo que se espera."},
                elenchos: {original: "·ºîŒªŒµŒ≥œáos", transliteration: "√©lenchos", meaning: "Prueba, convicci√≥n. La fe proporciona una certeza interior sobre realidades que no se ven."},
                epangelia: {original: "·ºêœÄŒ±Œ≥Œ≥ŒµŒªŒØŒ±", transliteration: "epangel√≠a", meaning: "Promesa. Un compromiso divino que es el objeto de la esperanza y la fe del creyente."},
                poimnion: {original: "œÄŒøŒØŒºŒΩŒπŒøŒΩ", transliteration: "po√≠mnion", meaning: "Reba√±o peque√±o. T√©rmino de cari√±o y ternura que Jes√∫s usa para sus disc√≠pulos, destacando su vulnerabilidad y la protecci√≥n de Dios."},
                kardia: {original: "Œ∫Œ±œÅŒ¥ŒØŒ±", transliteration: "kard√≠a", meaning: "Coraz√≥n. En la Biblia, no es solo el asiento de las emociones, sino el centro del intelecto, la voluntad y toda la persona."},
                gregore≈ç: {original: "Œ≥œÅŒ∑Œ≥ŒøœÅŒ≠œâ", transliteration: "grƒìgore≈ç", meaning: "Velar, estar despierto. Una actitud de alerta espiritual y preparaci√≥n constante para la venida del Se√±or."},
                doulos: {original: "Œ¥Œø·ø¶ŒªŒøœÇ", transliteration: "do√ªlos", meaning: "Siervo, esclavo. Describe la total devoci√≥n y obediencia a un amo; en el Nuevo Testamento, se usa para la relaci√≥n del creyente con Cristo."}
            };
            const ref = (key, num) => `<span class="ref-link" data-term='${JSON.stringify(terms[key]).replace(/'/g, "&#39;")}'><sup>${num}</sup></span>`;

            // --- COMPLETE LITURGICAL DATA GENERATOR ---
            function getLiturgyForDate(date) {
                const year = date.getFullYear();
                if (year !== 2025) return null;

                const toYYYYMMDD = d => `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
                const dateString = toYYYYMMDD(date);
                
                // --- Key Liturgical Dates for 2025 (Cycle C) ---
                const firstSundayOfAdvent2024 = new Date(2024, 11, 1);
                const christmasDay = new Date(2025, 11, 25);
                const epiphanySunday = new Date(2025, 0, 5);
                const baptismOfTheLord = new Date(2025, 0, 12);
                const ashWednesday = new Date(2025, 2, 5);
                const easter = new Date(2025, 3, 20);
                const pentecost = new Date(2025, 5, 8);
                const trinitySunday = new Date(2025, 5, 15);
                const christTheKing = new Date(2025, 10, 23);
                const firstSundayOfAdvent2025 = new Date(2025, 10, 30);

                // Helper to count Sundays between two dates (inclusive of start)
                const countSundays = (start, end) => {
                    let count = 0;
                    let current = new Date(start);
                    while (current <= end) {
                        if (current.getDay() === 0) {
                            count++;
                        }
                        current.setDate(current.getDate() + 1);
                    }
                    return count;
                };

                let season = '';
                let seasonColor = '#16a34a'; // Default green
                let title = '';
                let cycle = 'Ciclo C';

                // Determine Season
                if (date >= firstSundayOfAdvent2025) {
                    season = 'Advent'; seasonColor = '#6d28d9';
                } else if (date >= pentecost) {
                    season = 'Season after Pentecost'; seasonColor = '#16a34a';
                } else if (date >= easter) {
                    season = 'Easter'; seasonColor = '#f59e0b';
                } else if (date >= ashWednesday) {
                    season = 'Lent'; seasonColor = '#9333ea';
                } else if (date > epiphanySunday) {
                    season = 'Season after Epiphany'; seasonColor = '#16a34a';
                } else if (date >= new Date(2024, 11, 25)) {
                    season = 'Christmas'; seasonColor = '#ca8a04';
                } else {
                    season = 'Advent'; seasonColor = '#6d28d9';
                }

                const placeholderReadings = {
                    firstReading: { ref: 'Lectura I', text: 'Texto de la primera lectura no disponible.' },
                    psalm: { ref: 'Salmo Responsorial', response: 'Respuesta del salmo.', stanzas: ['Estrofa del salmo no disponible.'] },
                    secondReading: { ref: 'Lectura II', text: 'Texto de la segunda lectura no disponible.' },
                    alleluiaVerse: 'Vers√≠culo del Aleluya no disponible.',
                    gospel: { ref: 'Evangelio', text: 'Texto del Evangelio no disponible.' }
                };

                // --- SOLEMNITIES AND FEASTS (OVERRIDE SUNDAY LOGIC) ---
                const solemnities = {
                    '2025-01-01': { title: 'La Circuncisi√≥n y Santo Nombre de Nuestro Se√±or Jesucristo', color: '#e5e7eb' },
                    '2025-01-06': { title: 'La Epifan√≠a de Nuestro Se√±or Jesucristo', color: '#e5e7eb' },
                    '2025-03-05': { title: 'Mi√©rcoles de Ceniza', color: '#9333ea' },
                    '2025-04-17': { title: 'Jueves Santo', color: '#e5e7eb' },
                    '2025-04-18': { title: 'Viernes Santo', color: '#dc2626' },
                    '2025-04-19': { title: 'S√°bado Santo', color: '#e5e7eb' },
                    '2025-08-15': { title: 'Santa Mar√≠a Virgen, Madre de Nuestro Se√±or Jesucristo', color: '#e5e7eb' },
                    '2025-11-01': { title: 'D√≠a de Todos los Santos', color: '#e5e7eb' },
                    '2025-12-25': { title: 'El D√≠a de Navidad', color: '#f59e0b' },
                };

                if (solemnities[dateString]) {
                    title = solemnities[dateString].title;
                    seasonColor = solemnities[dateString].color;
                    cycle = 'D√≠a Santo';
                }

                // --- SUNDAY TITLES (LOC 2019) ---
                if (date.getDay() === 0 && !title) {
                    const ordinals = ["Primer", "Segundo", "Tercer", "Cuarto", "Quinto", "Sexto", "S√©ptimo", "Octavo", "Noveno", "D√©cimo"];

                    if (date >= firstSundayOfAdvent2025) {
                        const sundayIndex = countSundays(firstSundayOfAdvent2025, date);
                        title = `El ${ordinals[sundayIndex - 1]} Domingo de Adviento`;
                    } else if (date.getTime() === christTheKing.getTime()) {
                        title = 'El √öltimo Domingo despu√©s de Pentecost√©s: Cristo Rey';
                    } else if (date.getTime() === trinitySunday.getTime()) {
                        title = "El Domingo de la Sant√≠sima Trinidad";
                    } else if (date > trinitySunday) {
                        const sundayIndex = countSundays(trinitySunday, date);
                        title = `El ${ordinals[sundayIndex] || (sundayIndex + 1) + '¬∫'} Domingo despu√©s de Pentecost√©s`;
                    } else if (date.getTime() === pentecost.getTime()) {
                        title = 'El D√≠a de Pentecost√©s';
                    } else if (date.getTime() === easter.getTime()) {
                        title = 'Domingo de Pascua';
                    } else if (date > easter) {
                        const sundayIndex = countSundays(easter, date);
                        title = `El ${ordinals[sundayIndex - 1]} Domingo de Pascua`;
                    } else if (date.getTime() === addDays(ashWednesday, 46).getTime()) { // Palm Sunday
                        title = 'Domingo de Ramos: La Pasi√≥n del Se√±or';
                        seasonColor = '#dc2626';
                    } else if (date > ashWednesday) {
                        const sundayIndex = countSundays(addDays(ashWednesday, 4), date);
                        title = `El ${ordinals[sundayIndex - 1]} Domingo de Cuaresma`;
                    } else if (date.getTime() === baptismOfTheLord.getTime()) {
                        title = 'El Bautismo de Nuestro Se√±or Jesucristo';
                    } else if (date > epiphanySunday) {
                        const sundayIndex = countSundays(epiphanySunday, date);
                        title = `El ${ordinals[sundayIndex - 1]} Domingo despu√©s de la Epifan√≠a`;
                    } else if (date > new Date(2024, 11, 25)) {
                        title = 'El Primer Domingo despu√©s de Navidad';
                    } else if (date >= firstSundayOfAdvent2024) {
                        const sundayIndex = countSundays(firstSundayOfAdvent2024, date);
                        title = `El ${ordinals[sundayIndex - 1]} Domingo de Adviento`;
                    }
                }

                if (!title) return null;

                let liturgy = {
                    title: title,
                    cycle: cycle,
                    omitGloria: (season === 'Advent' || season === 'Lent'),
                    omitAlleluia: (season === 'Lent'),
                    seasonColor: seasonColor,
                    prayers: {},
                    readings: placeholderReadings
                };

                // Specific data for the example date
                if (dateString === '2025-08-10') {
                    liturgy.prayers = {
                        collect: 'Dios todopoderoso y eterno, a quien podemos llamar Padre, aumenta en nuestros cora√ß√µes el esp√≠ritu de hijos adoptivos, para que merezcamos entrar un d√≠a en la herencia prometida. Por nuestro Se√±or Jesucristo.',
                        offerings: 'S√© propicio, Se√±or, a tu pueblo y acepta con bondad estas ofrendas, para que, con la ayuda de tu piedad, a cada uno le aproveche para su salvaci√≥n lo que ofrece en honor de tu nombre. Por Jesucristo, nuestro Se√±or.',
                        postCommunion: 'Que la comuni√≥n en tus sacramentos nos salve, Se√±or, y nos afiance en la luz de tu verdad. Por Jesucristo, nuestro Se√±or.',
                        preface: 'En verdad es justo y necesario, es nuestro deber y salvaci√≥n darte gracias siempre y en todo lugar, Se√±or, Padre santo, Dios todopoderoso y eterno. Pues, aunque no necesitas nuestra alabanza, es don tuyo que seamos agradecidos; y aunque nuestras bendiciones no aumentan tu gloria, nos aprovechan para nuestra salvaci√≥n. Por Cristo, Se√±or nuestro. Por eso, unidos a los √°ngeles, te aclamamos llenos de alegr√≠a:'
                    };
                    liturgy.readings = {
                        firstReading: { ref: 'Sabidur√≠a 18, 6-9', text: `La noche de la liberaci√≥n fue anunciada de antemano a nuestros padres, para que tuvieran √°nimo al conocer con certeza la promesa de la que se fiaban. Tu pueblo esperaba, a la vez, la salvaci√≥n de los justos y la perdici√≥n de los enemigos. Porque con la misma acci√≥n que castigaste a los adversarios, nos glorificaste a nosotros, llam√°ndonos a ti. Los santos hijos de los buenos ofrec√≠an sacrificios a escondidas y establecieron de com√∫n acuerdo esta ley divina: que los santos compartir√≠an por igual los mismos bienes y peligros; y entonaron los himnos de los padres.` },
                        psalm: { ref: 'Salmo 32', response: 'Dichoso el pueblo que el Se√±or se escogi√≥ como heredad.', stanzas: [ `Aclamad, justos, al Se√±or,<br>que merece la alabanza de los buenos.<br>Dichosa la naci√≥n cuyo Dios es el Se√±or,<br>el pueblo que √©l se escogi√≥ como heredad.`, `El Se√±or mira desde el cielo,<br>se fija en todos los hombres.<br>Desde su morada observa<br>a todos los habitantes de la tierra.`, `Los ojos del Se√±or est√°n puestos en quien lo teme,<br>en los que esperan en su misericordia,<br>para librar sus vidas de la muerte<br>y reanimarlos en tiempo de hambre.`, `Nosotros aguardamos al Se√±or:<br>√©l es nuestro auxilio y escudo;<br>que tu misericordia, Se√±or, venga sobre nosotros,<br>como lo esperamos de ti.` ] },
                        secondReading: { ref: 'Hebreos 11, 1-2. 8-19', text: `Hermanos: La fe es garant√≠a${ref('hypostasis', 1)} de lo que se espera, la prueba${ref('elenchos', 2)} de las realidades que no se ven. Por ella fueron alabados nuestros mayores. Por la fe, Abrah√°n, al ser llamado por Dios, obedeci√≥ y sali√≥ para el lugar que hab√≠a de recibir en herencia, y sali√≥ sin saber a d√≥nde iba. Por la fe, se estableci√≥ en la tierra prometida como en tierra extra√±a, viviendo en tiendas, y lo mismo Isaac y Jacob, herederos de la misma promesa${ref('epangelia', 3)}, pues esperaba la ciudad de s√≥lidos cimientos, cuyo arquitecto y constructor es Dios. Por la fe, tambi√©n Sara, siendo est√©ril, obtuvo vigor para concebir, a pesar de su edad avanzada, porque crey√≥ que era fiel el que se lo promet√≠a. Y as√≠, de un solo hombre, y ya marcado por la muerte, nacieron hijos, numerosos como las estrellas del cielo e incontables como la arena de las playas. Con fe murieron todos estos, sin haber recibido las promesas; las vieron y las saludaron de lejos, confesando que eran extra√±os y peregrinos en la terra. Los que as√≠ hablan, dan a entender que buscan una patria; pues si hubieran pensado en la que hab√≠an abandonado, ten√≠an ocasi√≥n de volver. Pero ellos ansiaban una patria mejor, la celestial. Por eso Dios no se avergenza de llamarse su Dios, pues les ten√≠a preparada una ciudad. Por la fe, Abrah√°n, puesto a prueba, ofreci√≥ a Isaac; y el que hab√≠a recibido las promesas, ofrec√≠a a su unig√©nito, a quien se le hab√≠a dicho: ¬´La descendencia que lleve tu nombre ser√° la de Isaac¬ª. Pero Abrah√°n pensaba que Dios tiene poder hasta para resucitar de entre los muertos, de donde en cierto sentido lo recobr√≥.` },
                        alleluiaVerse: 'Estad en vela y preparados, porque a la hora que menos pens√©is viene el Hijo del hombre. (cf. Mt 24, 42a. 44)',
                        gospel: { ref: 'Lucas 12, 32-48', text: `En aquel tiempo, dijo Jes√∫s a sus disc√≠pulos: ¬´No temas, peque√±o reba√±o${ref('poimnion', 4)}, porque vuestro Padre ha tenido a bien daros el reino. Vended vuestros bienes y dad limosna. Haceos bolsas que no se estropeen, un tesoro inagotable en el cielo, adonde no se acercan los ladrones ni roe la polilla. Porque donde est√° vuestro tesoro, all√≠ estar√° tambi√©n vuestro coraz√≥n${ref('kardia', 5)}. Tened ce√±ida la cintura y encendidas las l√°mparas. Vosotros estad como los hombres que aguardan a que su se√±or vuelva de la boda, para abrirle apenas venga y llame. Bienaventurados aquellos criados a quienes el se√±or, al llegar, los encuentre en vela${ref('gregore≈ç', 6)}; en verdad os digo que se ce√±ir√°, los har√° sentar a la mesa y, acerc√°ndose, les ir√° sirviendo. Y, si llega a la segunda vigilia o a la tercera y los encuentra as√≠, ¬°bienaventurados ellos! Comprended que si supiera el due√±o de casa a qu√© hora viene el ladr√≥n, no le dejar√≠a abrir un boquete en su casa. Lo mismo vosotros, estad preparados, porque a la hora que menos pens√©is viene el Hijo del hombre¬ª. Pedro le dijo: ¬´Se√±or, ¬ødices esta par√°bola por nosotros o por todos?¬ª. Y el Se√±or dijo: ¬´¬øQui√©n es el administrador fiel y prudente a quien el se√±or pondr√° al frente de su servidumbre para que reparta la raci√≥n de alimento a sus horas? Bienaventurado aquel siervo${ref('doulos', 7)} a quien su se√±or, al llegar, lo encuentre port√°ndose as√≠. En verdad os digo que lo pondr√° al frente de todos sus bienes. Pero si aquel siervo dijere para sus adentros: ‚ÄúMi se√±or tarda en llegar‚Äù, y empieza a pegarles a los criados y a las criadas, a comer y beber y emborracharse, vendr√° el se√±or de ese siervo el d√≠a que menos lo espera y a la hora que no sabe y lo castigar√° con rigor, y le asignar√° la suerte de los infieles. El siervo que, conociendo la voluntad de su se√±or, no se prepara ni obra de acuerdo con su voluntad, recibir√° muchos azotes; pero el que, sin conocerla, ha hecho algo digno de azotes, recibir√° menos. A quien mucho se le dio, mucho se le reclamar√°; a quien mucho se le confi√≥, m√°s a√∫n se le pedir√°¬ª.` }
                    };
                }

                return liturgy;
            }
            
            // --- DOM ELEMENTS & STATE ---
            const splashScreen = document.getElementById('splash-screen');
            const mainContent = document.getElementById('main-content');
            const fullLiturgyView = document.getElementById('full-liturgy-view');
            const backToCalendarBtn = document.getElementById('back-to-calendar-btn');
            const printBtn = document.getElementById('print-btn');
            const downloadDocxBtn = document.getElementById('download-docx-btn');
            const hamburgerBtn = document.getElementById('hamburger-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const closeMenuBtn = document.getElementById('close-menu-btn');
            const mobileNavLinks = document.getElementById('mobile-nav-links');
            const mainNavButtons = { 
                home: document.getElementById('btn-home'),
                liturgy: document.getElementById('btn-liturgy'), 
                glossary: document.getElementById('btn-glossary'), 
                lectionary: document.getElementById('btn-lectionary')
            };
            const views = { 
                home: document.getElementById('home-view'),
                liturgy: document.getElementById('liturgy-view'), 
                glossary: document.getElementById('glossary-view'), 
                lectionary: document.getElementById('lectionary-view')
            };
            
            const fullLiturgyUI = { title: document.getElementById('full-liturgy-title'), subtitle: document.getElementById('full-liturgy-subtitle'), content: document.getElementById('full-liturgy-content') };
            const uploadLogoBtn = document.getElementById('btn-upload-logo');
            const logoUploader = document.getElementById('logo-uploader');
            const logoImage = document.getElementById('logo-image');
            
            const theologyPopup = document.getElementById('theology-popup');
            const theologyPopupOverlay = document.getElementById('theology-popup-overlay');
            const theologyPopupContent = document.getElementById('popup-content-theology');
            const theologyPopupClose = document.getElementById('popup-close');
            
            const lectionaryControls = document.getElementById('lectionary-controls');
            const monthSelector = document.getElementById('month-selector');
            const currentMonthYear = document.getElementById('current-month-year');
            const lectionaryDayGridContainer = document.getElementById('lectionary-day-grid-container');
            const lectionaryPopup = document.getElementById('lectionary-popup');
            const lectionaryPopupOverlay = document.getElementById('lectionary-popup-overlay');
            const lectionaryPopupTitle = document.getElementById('lectionary-popup-title');
            const lectionaryPopupBody = document.getElementById('lectionary-popup-body');
            const lectionaryPopupClose = document.getElementById('lectionary-popup-close');
            const cardsContainer = document.getElementById('liturgical-cards-container');

            // --- FUNCTIONS ---
            function switchView(viewName) {
                Object.values(views).forEach(v => v.classList.add('hidden'));
                Object.values(mainNavButtons).forEach(b => b.classList.remove('active-nav'));
                if (views[viewName]) {
                    views[viewName].classList.remove('hidden');
                }
                if (mainNavButtons[viewName]) {
                    mainNavButtons[viewName].classList.add('active-nav');
                }
            }
            
            function renderLiturgicalCards() {
                cardsContainer.innerHTML = '';
                const startDate = new Date(2025, 0, 1);
                const endDate = new Date(2025, 11, 31);

                for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                    const liturgyData = getLiturgyForDate(new Date(d));
                    if (liturgyData) {
                        const card = document.createElement('div');
                        card.className = 'liturgical-card flex items-center p-4 rounded-lg shadow-md cursor-pointer';
                        card.style.borderColor = liturgyData.seasonColor;
                        card.dataset.date = d.toISOString().split('T')[0];
                        
                        card.innerHTML = `
                            <div class="flex-shrink-0 w-20 text-center">
                                <p class="text-gray-500 text-sm">${d.toLocaleDateString('es-ES', { weekday: 'short' }).replace('.', '')}</p>
                                <p class="text-2xl font-bold text-gray-800">${d.getDate()}</p>
                                <p class="text-gray-500 text-sm">${d.toLocaleDateString('es-ES', { month: 'short' }).replace('.', '')}</p>
                            </div>
                            <div class="flex-grow pl-4">
                                <h3 class="font-bold text-lg text-gray-900">${liturgyData.title}</h3>
                                <p class="text-sm text-gray-600">${liturgyData.cycle}</p>
                            </div>
                            <div class="flex-shrink-0">
                               <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </div>
                        `;
                        cardsContainer.appendChild(card);
                    }
                }
            }

            function showFullLiturgy(date) {
                renderFullLiturgyView(date); 
                mainContent.classList.add('hidden');
                fullLiturgyView.classList.remove('hidden');
                fullLiturgyView.scrollTop = 0;
            }

            function renderFullLiturgyView(date) {
                const liturgy = getLiturgyForDate(date);
                if (liturgy && liturgy.readings && liturgy.readings.firstReading.text !== 'Texto de la primera lectura no disponible.') {
                    fullLiturgyUI.title.textContent = liturgy.title;
                    const formattedDate = date.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    fullLiturgyUI.subtitle.textContent = `${formattedDate} | ${liturgy.cycle}`;
                    
                    const templates = {
                        initialGreeting: `<h3>Saludo Inicial</h3><p class="liturgy-text">En el nombre del Padre, y del Hijo, y del Esp√≠ritu Santo.<br><strong>Am√©n.</strong><br>La gracia de nuestro Se√±or Jesucristo, el amor del Padre y la comuni√≥n del Esp√≠ritu Santo est√© con todos ustedes.<br><strong>Y con tu esp√≠ritu.</strong></p>`,
                        penitentialAct: `<h3>Acto Penitencial (Libro de Oraci√≥n Com√∫n ACNA)</h3><p class="liturgy-text">Amados en el Se√±or, acerqu√©monos con un coraz√≥n penitente y obediente a la Palabra de Dios, confesando nuestros pecados para que podamos recibir el perd√≥n por su infinita bondad y misericordia.<br><em>Se guarda un momento de silencio.</em><br><strong>Misericordios√≠simo Dios, confesamos que hemos pecado contra ti en pensamiento, palabra y obra, por lo que hemos hecho y por lo que hemos dejado de hacer. No te hemos amado con todo nuestro coraz√≥n; no hemos amado a nuestro pr√≥jimo como a nosotros mismos. Lo sentimos de veras y nos arrepentimos humildemente. Por tu Hijo Jesucristo, ten misericordia de nosotros y perd√≥nanos, para que nos deleitemos en tu voluntad y andemos en tus caminos, para la gloria de tu Nombre. Am√©n.</strong><br>Dios todopoderoso tenga misericordia de nosotros, perdone nuestros pecados y nos lleve a la vida eterna.<br><strong>Am√©n.</strong></p>`,
                        gloria: `<h3>Gloria</h3><p class="liturgy-text"><strong>Gloria a Dios en el cielo, y en la tierra paz a los hombres que ama el Se√±or. Por tu inmensa gloria te alabamos, te bendecimos, te adoramos, te glorificamos, te damos gracias, Se√±or Dios, Rey celestial, Dios Padre todopoderoso. Se√±or, Hijo √∫nico, Jesucristo. Se√±or Dios, Cordero de Dios, Hijo del Padre; t√∫ que quitas el pecado del mundo, ten piedad de nosotros; t√∫ que quitas el pecado del mundo, atiende nuestra s√∫plica; t√∫ que est√°s sentado a la derecha del Padre, ten piedad de nosotros. Porque s√≥lo t√∫ eres Santo, s√≥lo t√∫ Se√±or, s√≥lo t√∫ Alt√≠simo, Jesucristo, con el Esp√≠ritu Santo en la gloria de Dios Padre. Am√©n.</strong></p>`,
                        alleluia: (verse) => `<h3>Aleluya</h3><p class="liturgy-text"><strong>Aleluya, aleluya.</strong><br>${verse}<br><strong>Aleluya.</strong></p>`,
                        gospelAcclamation: (verse) => `<h3>Aclamaci√≥n antes del Evangelio</h3><p class="liturgy-text">${verse}</p>`,
                        gospel: (gospelData) => `<h3>Evangelio: ${gospelData.ref}</h3><p class="liturgy-text">El Se√±or est√© con ustedes.<br><strong>Y con tu esp√≠ritu.</strong><br>Lectura del santo Evangelio seg√∫n san ${gospelData.ref.split(' ')[0]}.<br><strong>Gloria a ti, Se√±or.</strong></p><p class="liturgy-text">${gospelData.text}</p><p class="liturgy-text">Palabra del Se√±or.<br><strong>Gloria a ti, Se√±or Jes√∫s.</strong></p>`,
                        credo: `<h3>Profesi√≥n de Fe - Credo Niceno</h3><p class="liturgy-text"><strong>Creo en un solo Dios, Padre todopoderoso, Creador del cielo y de la tierra, de todo lo visible y lo invisible. Creo en un solo Se√±or, Jesucristo, Hijo √∫nico de Dios, nacido del Padre antes de todos los siglos: Dios de Dios, Luz de Luz, Dios verdadero de Dios verdadero, engendrado, no creado, de la misma naturaleza del Padre, por quien todo fue hecho; que por nosotros, los hombres, y por nuestra salvation baj√≥ del cielo, y por obra del Esp√≠ritu Santo se encarn√≥ de Mar√≠a, la Virgen, y se hizo hombre; y por nuestra causa fue crucificado en tiempos de Poncio Pilato; padeci√≥ y fue sepultado, y resucit√≥ al tercer d√≠a, seg√∫n las Escrituras, y subi√≥ al cielo, y est√° sentado a la derecha del Padre; y de nuevo vendr√° con gloria para juzgar a vivos y muertos, y su reino no tendr√° fin. Creo en el Esp√≠ritu Santo, Se√±or y dador de vida, que procede del Padre y del Hijo, que con el Padre y del Hijo recibe una misma adoraci√≥n y gloria, y que habl√≥ por los profetas. Creo en la Iglesia, que es una, santa, cat√≥lica –∏ apost√≥lica. Confieso que hay un solo bautismo para el perd√≥n de los pecados. Espero la resurrecci√≥n de los muertos y la vida del mundo futuro. Am√©n.</strong></p>`,
                        prayerOfTheFaithful: `<h3>Oraci√≥n de los Fieles</h3><p class="liturgy-text">Hermanos, oremos a Dios Padre todopoderoso, que escucha siempre la oraci√≥n de sus hijos. Digamos con fe:<br><strong>Te rogamos, √≥yenos.</strong><br><em>(Se presentan las intenciones)</em><br>Escucha, Padre, nuestra oraci√≥n y conc√©denos aquellos dones que con fe te pedimos. Por Jesucristo, nuestro Se√±or.<br><strong>Am√©n.</strong></p>`,
                        eucharisticPrayerII: (preface) => `<h3>Plegaria Eucar√≠stica II</h3><p class="liturgy-text">El Se√±or est√© con ustedes.<br><strong>Y con tu esp√≠ritu.</strong><br>Levantemos el coraz√≥n.<br><strong>Lo tenemos levantado hacia el Se√±or.</strong><br>Demos gracias al Se√±or, nuestro Dios.<br><strong>Es justo y necesario.</strong></p><p class="liturgy-text">${preface}</p><p class="liturgy-text"><strong>Santo, Santo, Santo es el Se√±or, Dios del Universo. Llenos est√°n el cielo y la tierra de tu gloria. Hosanna en el cielo. Bendito el que viene en nombre del Se√±or. Hosanna en el cielo.</strong></p><p class="liturgy-text">Santo eres en verdad, Se√±or, fuente de toda santidad; por eso te pedimos que santifiques estos dones con la efusi√≥n de tu Esp√≠ritu, de manera que se conviertan para nosotros en el Cuerpo y la Sangre de Jesucristo, nuestro Se√±or. El cual, cuando iba a ser entregado a su Pasi√≥n, voluntariamente aceptada, tom√≥ pan, d√°ndote gracias, lo parti√≥ y lo dio a sus disc√≠pulos, diciendo: <strong>¬´TOMEN Y COMAN TODOS DE √âL, PORQUE ESTO ES MI CUERPO, QUE SER√Å ENTREGADO POR USTEDES¬ª.</strong> Del mismo modo, acabada la cena, tom√≥ el c√°liz, y, d√°ndote gracias de nuevo, lo pas√≥ a sus disc√≠pulos, diciendo: <strong>¬´TOMEN Y BEBAN TODOS DE √âL, PORQUE ESTE ES EL C√ÅLIZ DE MI SANGRE, SANGRE DE LA ALIANZA NUEVA Y ETERNA, QUE SER√Å DERRAMADA POR USTEDES Y POR MUCHOS PARA EL PERD√ìN DE LOS PECADOS. HAGAN ESTO EN CONMEMORACI√ìN M√çA¬ª.</strong> Este es el Misterio de la fe.<br><strong>Anunciamos tu muerte, proclamamos tu resurrecci√≥n. ¬°Ven, Se√±or Jes√∫s!</strong></p><p class="liturgy-text">As√≠, pues, Padre, al celebrar ahora el memorial de la muerte y resurrecci√≥n de tu Hijo, te ofrecemos el pan de vida y el c√°liz de salvaci√≥n, y te damos gracias porque nos haces dignos de servirte en tu presencia. Te pedimos humildemente que el Esp√≠ritu Santo congregue en la unidad a cuantos participamos del Cuerpo y la Sangre de Cristo. Por Cristo, con √©l y en √©l, a ti, Dios Padre omnipotente, en la unidad del Esp√≠ritu Santo, todo honor y toda gloria por los siglos de los siglos.<br><strong>Am√©n.</strong></p>`,
                        communionRite: `<h3>Rito de la Comuni√≥n</h3><p class="liturgy-text">Fieles a la recomendaci√≥n del Salvador y siguiendo su divina ense√±anza, nos atrevemos a decir:<br><strong>Padre nuestro, que est√°s en el cielo, santificado sea tu Nombre; venga a nosotros tu reino; h√°gase tu voluntad en la tierra como en el cielo. Danos hoy nuestro pan de cada d√≠a; perdona nuestras ofensas, como tambi√©n nosotros perdonamos a los que nos ofenden; no nos dejes caer en la tentaci√≥n, y l√≠branos del mal.</strong><br>L√≠branos de todos los males, Se√±or, y conc√©denos la paz en nuestros d√≠as, para que, ayudados por tu misericordia, vivamos siempre libres de pecado y protegidos de toda perturbaci√≥n, mientras esperamos la gloriosa venida de nuestro Salvador Jesucristo.<br><strong>Tuyo es el reino, tuyo el poder y la gloria, por siempre, Se√±or.</strong><br>Se√±or Jesucristo, que dijiste a tus ap√≥stoles: ¬´La paz les dejo, mi paz les doy¬ª, no tengas en cuenta nossos pecados, sino la fe de tu Iglesia y, conforme a tu palabra, conc√©dele la paz y la unidad. T√∫ que vives y reinas por los siglos de los siglos.<br><strong>Am√©n.</strong><br>La paz del Se√±or est√© siempre con ustedes.<br><strong>Y con tu esp√≠ritu.</strong></p><p class="liturgy-text"><strong>Cordero de Dios, que quitas el pecado del mundo, ten piedad de nosotros.</strong><br><strong>Cordero de Dios, que quitas el pecado del mundo, ten piedad de nosotros.</strong><br><strong>Cordero de Dios, que quitas el pecado del mundo, danos la paz.</strong></p><p class="liturgy-text">Este es el Cordero de Dios, que quita el pecado del mundo. Dichosos los invitados a la cena del Se√±or.<br><strong>Se√±or, no soy digno de que entres en mi casa, pero una palabra tuya bastar√° para sanarme.</strong></p>`,
                        acnaPostCommunion: `<h3>Oraci√≥n despu√©s de la Comuni√≥n (ACNA)</h3><p class="liturgy-text"><strong>Padre Celestial, te damos gracias por alimentarnos con el alimento espiritual del precios√≠simo Cuerpo y Sangre de tu Hijo nuestro Salvador Jesucristo; y por asegurarnos en estos santos misterios que somos miembros vivos de tu Hijo y herederos de tu reino eterno. Y te suplicamos, oh Se√±or, que nos asistas con tu gracia, para que continuemos en esa santa confraternidad, y hagamos todas las buenas obras que has preparado para que andemos en ellas; por Jesucristo nuestro Se√±or, a quien, contigo y el Esp√≠ritu Santo, sea todo honor y gloria, por los siglos de los siglos. Am√©n.</strong></p>`,
                        concludingRites: `<h3>Rito de Conclusi√≥n</h3><p class="liturgy-text">El Se√±or est√© con ustedes.<br><strong>Y con tu esp√≠ritu.</strong><br>La bendici√≥n de Dios todopoderoso, Padre, Hijo, y Esp√≠ritu Santo, descienda sobre ustedes y permanezca para siempre.<br><strong>Am√©n.</strong><br>Pueden ir en paz.<br><strong>Demos gracias a Dios.</strong></p>`
                    };

                    const entranceProcession = `<h3>Procesi√≥n de Entrada</h3><p class="liturgy-text italic">(Se canta un himno o ant√≠fona de entrada apropiado)</p>`;
                    const introductoryRites = entranceProcession + templates.initialGreeting + templates.penitentialAct + (liturgy.omitGloria ? '' : templates.gloria) + `<h3>Oraci√≥n Colecta</h3><p class="liturgy-text">${liturgy.prayers.collect}</p>`;
                    
                    let psalmContentHtml = `<strong>R. ${liturgy.readings.psalm.response}</strong><br><br>` + liturgy.readings.psalm.stanzas.join(`<br><br><strong>R. ${liturgy.readings.psalm.response}</strong><br><br>`);

                    let gospelAcclamationHtml = liturgy.omitAlleluia ? templates.gospelAcclamation(liturgy.readings.gospelAcclamationVerse) : templates.alleluia(liturgy.readings.alleluiaVerse);

                    const liturgyOfTheWord = `<h3>Primera Lectura: ${liturgy.readings.firstReading.ref}</h3><p class="liturgy-text">${liturgy.readings.firstReading.text}</p><h3>Salmo Responsorial: ${liturgy.readings.psalm.ref}</h3><p class="liturgy-text">${psalmContentHtml}</p>${liturgy.readings.secondReading ? `<h3>Segunda Lectura: ${liturgy.readings.secondReading.ref}</h3><p class="liturgy-text">${liturgy.readings.secondReading.text}</p>` : ''}${gospelAcclamationHtml}${templates.gospel(liturgy.readings.gospel)}<h3>Homil√≠a</h3><p class="liturgy-text italic">(Reflexi√≥n sobre las lecturas)</p>${templates.credo}${templates.prayerOfTheFaithful}`;
                    
                    const liturgyOfTheEucharist = `<h3>Presentaci√≥n de las Ofrendas</h3><p class="liturgy-text">Oren, hermanos, para que este sacrificio, m√≠o y de ustedes, sea agradable a Dios, Padre todopoderoso.<br><strong>El Se√±or reciba de tus manos este sacrificio, para alabanza y gloria de su nombre, para nuestro bien y el de toda su santa Iglesia.</strong></p><h3>Oraci√≥n sobre las Ofrendas</h3><p class="liturgy-text">${liturgy.prayers.offerings}</p>${templates.eucharisticPrayerII(liturgy.prayers.preface)}${templates.communionRite}`;
                    
                    const concludingRites = `<h3>Oraci√≥n despu√©s de la Comuni√≥n</h3><p class="liturgy-text">${liturgy.prayers.postCommunion}</p>${templates.acnaPostCommunion}${templates.concludingRites}`;

                    const finalHtml = `<div class="bg-white p-6 rounded-lg shadow-md">
                                        <div class="liturgy-section"><h2>Ritos Iniciales</h2>${introductoryRites}</div>
                                        <div class="liturgy-section"><h2>Liturgia de la Palabra</h2>${liturgyOfTheWord}</div>
                                        <div class="liturgy-section"><h2>Liturgia Eucar√≠stica</h2>${liturgyOfTheEucharist}</div>
                                        <div class="liturgy-section"><h2>Ritos de Conclusi√≥n</h2>${concludingRites}</div>
                                    </div>`;

                    fullLiturgyUI.content.innerHTML = finalHtml;

                } else {
                    fullLiturgyUI.title.textContent = 'Liturgia no Disponible';
                    fullLiturgyUI.subtitle.textContent = date.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    fullLiturgyUI.content.innerHTML = `<div class="bg-white p-8 rounded-lg shadow-md text-center"><p class="text-gray-600 py-16">Lo sentimos, la liturgia completa para este d√≠a a√∫n no ha sido implementada.</p></div>`;
                }
            }


            function hideFullLiturgy() {
                mainContent.classList.remove('hidden');
                fullLiturgyView.classList.add('hidden');
            }

            function loadLogoFromStorage() {
                const savedLogo = localStorage.getItem('userLogo');
                if (savedLogo) {
                    logoImage.src = savedLogo;
                }
            }

            // --- THEOLOGY POPUP LOGIC ---
            function showTheologyPopup(event) {
                const refLink = event.target.closest('.ref-link');
                if (refLink) {
                    event.preventDefault();
                    event.stopPropagation();
                    const data = JSON.parse(refLink.dataset.term);
                    
                    let commentaryHtml = data.commentary ? `<hr class="my-3 border-gray-200"><h5 class="text-teal-700 font-bold mt-2">Comentario Teol√≥gico</h5><p class="text-sm text-gray-600">${data.commentary}</p>` : '';

                    theologyPopupContent.innerHTML = `
                        <h5 class="text-teal-700 font-bold">${data.transliteration}</h5>
                        <p class="original-term text-gray-700 mb-2">${data.original}</p>
                        <p class="text-gray-800">${data.meaning}</p>
                        ${commentaryHtml}
                    `;
                    
                    theologyPopupOverlay.style.display = 'block';
                    theologyPopup.style.display = 'block';
                    document.body.style.overflow = 'hidden'; 
                }
            }
            
            function closeTheologyPopup() {
                theologyPopup.style.display = 'none';
                theologyPopupOverlay.style.display = 'none';
                document.body.style.overflow = ''; 
            }

            // --- LECTIONARY LOGIC ---
            const lectionaryData = {
                // Data for August 2025 (Year 1)
                "2025-08-01": { 
                    collect: "Oh Se√±or, te rogamos que nos concedas un aumento de fe, esperanza y caridad; y, para que obtengamos lo que prometes, haznos amar lo que mandas; por Jesucristo nuestro Se√±or, que vive y reina contigo y el Esp√≠ritu Santo, un solo Dios, por los siglos de los siglos. Am√©n.",
                    morning: { psalms: {ref: "Salmo 31", text: "En ti, Se√±or, busco refugio; jam√°s permitas que me averg√ºencen; en tu justicia, l√≠brame. Inclina a m√≠ tu o√≠do, y ven pronto a socorrerme. S√© t√∫ mi roca de refugio, la fortaleza de mi salvaci√≥n. Gu√≠ame, pues eres mi roca y mi fortaleza, dir√≠geme por amor a tu nombre. L√≠brame de la trampa que me han tendido, porque t√∫ eres mi refugio. En tus manos encomiendo mi esp√≠ritu; l√≠brame, Se√±or, Dios de la verdad. Odio a los que veneran √≠dolos vanos, pero yo en el Se√±or conf√≠o. Me alegro y me regocijo en tu amor, porque has visto mi aflicci√≥n y conoces las angustias de mi alma. No me entregaste en manos del enemigo, sino que me pusiste en un lugar espacioso. Ten compasi√≥n de m√≠, Se√±or, que estoy angustiado; el dolor est√° acabando con mis ojos, con mi alma, ¬°con mi cuerpo! La vida se me va en angustias, y los a√±os en lamentos; la tristeza debilita mis fuerzas, y mis huesos se van consumiendo. Soy el hazmerre√≠r de todos mis enemigos, de mis vecinos y de mis parientes; de m√≠ huyen los que me conocen, los que me ven en la calle. Me han olvidado, como si hubiera muerto; soy como una vasija hecha pedazos. Oigo los cuchicheos de la multitud; el terror me asalta por doquier, pues conspiran contra m√≠ y traman quitarme la vida. Pero yo, Se√±or, en ti conf√≠o, y digo: ¬´T√∫ eres mi Dios¬ª. Mi vida entera est√° en tus manos; l√≠brame de mis enemigos y perseguidores. Que tu rostro resplandezca sobre tu siervo; por tu gran amor, s√°lvame. Se√±or, no permitas que me averg√ºencen, porque a ti he clamado. Que sean avergonzados los malvados, y acallados en el sepulcro. Que sean silenciados sus labios mentirosos, porque hablan contra los justos con orgullo, desd√©n e insolencia. ¬°Cu√°n grande es tu bondad, que atesoras para los que te temen, y que a la vista de la gente derramas sobre los que en ti se refugian! Al amparo de tu presencia los proteges de las intrigas humanas; en tu morada los resguardas de las lenguas contenciosas. ¬°Bendito sea el Se√±or, pues me ha mostrado las maravillas de su amor cuando me hallaba en una ciudad sitiada! En mi angustia llegu√© a decir: ¬´¬°He sido arrojado de tu presencia!¬ª Pero t√∫ o√≠ste mi voz suplicante cuando a ti clam√© pidiendo ayuda. Amen al Se√±or, todos sus fieles; el Se√±or protege a los que le son leales, pero a los soberbios les da su merecido. ¬°Cobren √°nimo y √°rmense de valor, todos los que en el Se√±or esperan!"}, ot: {ref: "1 Samuel 2:11-26", text: "Luego Elcan√° se fue a su casa en Ram√°, pero el ni√±o se qued√≥ para servir al Se√±or bajo el cuidado del sacerdote El√≠. Los hijos de El√≠ eran unos malvados, y no les importaba el Se√±or ni los deberes de los sacerdotes para con el pueblo. Cuando alguien ofrec√≠a un sacrificio, el criado del sacerdote iba con un tenedor de tres dientes y, mientras se coc√≠a la carne, lo met√≠a en el perol, en la olla, en la caldera o en el caldero; y todo lo que sacaba el tenedor era para el sacerdote. As√≠ trataban a todo israelita que iba a Sil√≥. Es m√°s, aun antes de que se quemara la grasa, el criado del sacerdote iba y le dec√≠a al que sacrificaba: ¬´Dame carne para as√°rsela al sacerdote, porque no te va a aceptar la carne cocida, sino cruda¬ª. Si el hombre le respond√≠a: ¬´Deja que primero se queme la grasa, y luego toma lo que quieras¬ª, el criado le contestaba: ¬´No, d√°mela ahora mismo; de lo contrario, te la quitar√© por la fuerza¬ª. El pecado de estos j√≥venes era muy grave a los ojos del Se√±or, pues trataban con desprecio las ofrendas que pertenec√≠an al Se√±or. El joven Samuel, por su parte, ministraba delante del Se√±or, vestido con un efod de lino. Cada a√±o su madre le hac√≠a una peque√±a t√∫nica y se la llevaba cuando iba con su esposo para ofrecer el sacrificio anual. Y El√≠ bendec√≠a a Elcan√° y a su esposa con estas palabras: ¬´Que el Se√±or te d√© hijos de esta mujer, para que tomen el lugar del que ella pidi√≥ y dedic√≥ al Se√±or¬ª. Despu√©s de eso, regresaban a su casa. Y el Se√±or bendijo a Ana, y ella tuvo tres hijos y dos hijas. Mientras tanto, el joven Samuel crec√≠a en la presencia del Se√±or. El√≠, que ya era muy anciano, se enter√≥ de todo lo que sus hijos le hac√≠an a Israel y de que se acostaban con las mujeres que serv√≠an a la entrada del Tabern√°culo de reuni√≥n. As√≠ que les dijo: ¬´¬øPor qu√© hacen estas cosas? Todo el pueblo me habla de su mala conducta. ¬°No, hijos m√≠os! No es bueno el rumor que se oye entre el pueblo del Se√±or. Si alguien peca contra otra persona, Dios puede intervenir; pero si peca contra el Se√±or, ¬øqui√©n podr√° interceder por √©l?¬ª Sin embargo, ellos no le hicieron caso a la advertencia de su padre, pues el Se√±or hab√≠a resuelto quitarles la vida. En cambio, el joven Samuel segu√≠a creciendo y gan√°ndose el aprecio del Se√±or y de la gente."}, nt: {ref: "Hechos 2:14-36", text: "Entonces Pedro, con los once, se puso de pie y dijo a voz en cuello: ¬´Compatriotas jud√≠os y todos ustedes que est√°n en Jerusal√©n, d√©jenme explicarles lo que sucede; presten atenci√≥n a mis palabras. Estos no est√°n borrachos, como suponen ustedes. ¬°Apenas son las nueve de la ma√±ana! En realidad lo que pasa es lo que anunci√≥ el profeta Joel: ‚ÄúSuceder√° que en los √∫ltimos d√≠as ‚Äîdice Dios‚Äî, derramar√© mi Esp√≠ritu sobre todo el g√©nero humano. Los hijos y las hijas de ustedes profetizar√°n, tendr√°n visiones los j√≥venes y sue√±os los ancianos. En esos d√≠as derramar√© mi Esp√≠ritu aun sobre mis siervos y mis siervas, y profetizar√°n. Arriba en el cielo y abajo en la tierra mostrar√© prodigios: sangre, fuego y nubes de humo. El sol se convertir√° en tinieblas y la luna en sangre antes que llegue el d√≠a del Se√±or, d√≠a grande y glorioso. Y todo el que invoque el nombre del Se√±or ser√° salvo‚Äù. ¬ªPueblo de Israel, escuchen estas palabras: Jes√∫s de Nazaret fue un hombre acreditado por Dios ante ustedes con milagros, se√±ales y prodigios, los cuales Dios mismo realiz√≥ entre ustedes por medio de √©l, como bien lo saben. Este, que fue entregado por el determinado prop√≥sito y el previo conocimiento de Dios, ustedes lo mataron, clav√°ndolo en la cruz por manos de imp√≠os. Sin embargo, Dios lo resucit√≥, libr√°ndolo de las angustias de la muerte, porque era imposible que la muerte lo mantuviera bajo su dominio. En efecto, David dijo de √©l: ‚ÄúVe√≠a yo al Se√±or siempre delante de m√≠; con √©l a mi derecha, nada me har√° caer. Por eso mi coraz√≥n se alegra y canta con gozo mi lengua; mi cuerpo tambi√©n vivir√° en esperanza. No dejar√°s que mi vida termine en el sepulcro; no permitir√°s que tu Santo sufra corrupci√≥n. Me has dado a conocer los caminos de la vida; me llenar√°s de alegr√≠a en tu presencia‚Äù. ¬ªHermanos, perm√≠tanme hablarles con franqueza sobre el patriarca David, que muri√≥ y fue sepultado, y cuyo sepulcro est√° entre nosotros hasta el d√≠a de hoy. Pero como era profeta y sab√≠a que Dios le hab√≠a jurado que uno de sus descendientes se sentar√≠a en su trono, previendo esto, habl√≥ de la resurrecci√≥n del Cristo, que no fue abandonado en el sepulcro ni su cuerpo sufri√≥ corrupci√≥n. A este Jes√∫s, Dios lo resucit√≥, y de ello todos nosotros somos testigos. Exaltado por el poder de Dios, y habiendo recibido del Padre el Esp√≠ritu Santo prometido, ha derramado esto que ustedes ahora ven y oyen. Porque David no subi√≥ al cielo, y sin embargo declar√≥: ‚ÄúDijo el Se√±or a mi Se√±or: Si√©ntate a mi derecha, hasta que ponga a tus enemigos por estrado de tus pies‚Äù. ¬ªPor tanto, s√©palo bien todo el pueblo de Israel que a este Jes√∫s, a quien ustedes crucificaron, Dios lo ha hecho Se√±or y Cristo¬ª."} }, 
                    evening: { psalms: {ref: "Salmo 35", text: "Disputa, Se√±or, con los que contra m√≠ contienden; combate a los que me combaten. Echa mano del escudo y del broquel, y lev√°ntate en mi ayuda. Empu√±a la lanza y el hacha, y haz frente a mis perseguidores. Quiero o√≠rte decir: ¬´Yo soy tu salvaci√≥n¬ª. Queden confundidos y avergonzados los que procuran mi muerte; retrocedan y queden humillados los que traman mi mal. Que sean como la paja que se lleva el viento, acosados por el √°ngel del Se√±or. Que su senda se vuelva oscura y resbaladiza, perseguidos por el √°ngel del Se√±or. Sin motivo me tendieron una trampa; sin motivo cavaron una fosa para m√≠. Que la ruina los tome por sorpresa; que caigan en la trampa que me tendieron, que en su propia trampa se destruyan. As√≠ mi alma se alegrar√° en el Se√±or y se deleitar√° en su salvaci√≥n. Todo mi ser exclamar√°: ¬´¬øQui√©n como t√∫, Se√±or? Libras al pobre del que es m√°s fuerte; al pobre y al necesitado, de quienes los explotan¬ª. Se presentan testigos despiadados y me interrogan por cosas que yo ignoro. Me pagan mal por bien, y mi alma se aflige. Cuando ellos se enfermaban, yo me vest√≠a de luto; me aflig√≠a con ayunos, y oraba con la cabeza sobre el pecho. Como por un amigo o un hermano, andaba yo de luto; como quien llora por su madre, me humillaba con tristeza. Pero, cuando yo tropec√©, se alegraron y se juntaron; se juntaron contra m√≠ los que no conoc√≠a; me calumniaban sin cesar. Como imp√≠os en un banquete, se burlaban de m√≠ y rechinaban los dientes. ¬øHasta cu√°ndo, Se√±or, vas a tolerarlo? Libra mi vida de sus ataques; ¬°libra mi √∫nica vida de estos leones! Te dar√© gracias en la gran asamblea; ante una multitud te alabar√©. No dejes que de m√≠ se burlen mis enemigos traicioneros; no permitas que se gui√±en el ojo los que me odian sin motivo. Porque no hablan de paz, sino que urden calumnias contra la gente pac√≠fica de la tierra. De par en par abren la boca y gritan: ¬´¬°Ja, ja! ¬°Con nuestros ojos lo hemos visto!¬ª T√∫ lo has visto, Se√±or; no te quedes callado. ¬°Se√±or, no te alejes de m√≠! ¬°Despierta, Dios m√≠o, y lev√°ntate! ¬°Defi√©ndeme, Se√±or, y hazme justicia! J√∫zgame, Se√±or mi Dios, conforme a tu justicia; no dejes que de m√≠ se burlen. No permitas que piensen: ¬´¬°As√≠ quer√≠amos!¬ª; ni que digan: ¬´¬°Nos lo hemos tragado vivo!¬ª Queden avergonzados y confundidos todos los que se alegran de mi desgracia; que la verg√ºenza y el deshonor cubran a todos los que se creen m√°s que yo. Pero griten de alegr√≠a y regocijo los que se deleitan en mi vindicaci√≥n, y digan siempre: ¬´¬°Exaltado sea el Se√±or, que se deleita en el bienestar de su siervo!¬ª Con mi lengua proclamar√© tu justicia, y todo el d√≠a te alabar√©."}, ot: {ref: "1 Samuel 2:27-36", text: "Y vino un var√≥n de Dios a El√≠..."}, nt: {ref: "Marcos 1:1-13", text: "Principio del evangelio de Jesucristo, Hijo de Dios..."} }
                },
                "2025-08-02": { 
                    collect: "Oh Dios, que declaras tu poder todopoderoso principalmente en mostrar misericordia y piedad: Conc√©denos tal medida de tu gracia, que, corriendo por el camino de tus mandamientos, obtengamos tus promesas de gracia y seamos hechos part√≠cipes de tu tesoro celestial; por Jesucristo nuestro Se√±or. Am√©n.",
                    morning: { psalms: {ref: "Salmo 30, 32", text: "Te exaltar√©, Se√±or, porque me levantaste... Bienaventurado aquel cuya transgresi√≥n ha sido perdonada..."}, ot: {ref: "1 Samuel 3:1-21", text: "El joven Samuel ministraba al Se√±or en presencia de El√≠..."}, nt: {ref: "Hechos 2:37-47", text: "Al o√≠r esto, se compungieron de coraz√≥n..."} }, 
                    evening: { psalms: {ref: "Salmo 36, 39", text: "La maldad del imp√≠o me dice al coraz√≥n... Yo dije: Atender√© a mis caminos, para no pecar con mi lengua..."}, ot: {ref: "1 Samuel 4:1-11", text: "Y sali√≥ Israel a la batalla contra los filisteos..."}, nt: {ref: "Marcos 1:14-28", text: "Despu√©s que Juan fue encarcelado, Jes√∫s vino a Galilea..."} }
                },
                // ... (Continue for all days in August)
                "2025-08-31": { 
                    collect: "Se√±or de todo poder y majestad, cuyo amor eterno nos ha tra√≠do a la vida y nos sostiene en cada momento: Danos tal gratitud por tu bondad que te alabemos no solo con nuestros labios, sino en nuestras vidas, por Jesucristo nuestro Se√±or. Am√©n.",
                    morning: { psalms: {ref: "Salmo 120, 121, 122", text: "A ti levanto mis ojos, a ti que habitas en los cielos..."}, ot: {ref: "2 Samuel 7:1-17", text: "Aconteci√≥ que cuando ya el rey habitaba en su casa..."}, nt: {ref: "Hechos 13:13-25", text: "Habiendo zarpado de Pafos, Pablo y sus compa√±eros..."} }, 
                    evening: { psalms: {ref: "Salmo 123, 124, 125", text: "Si no hubiera sido por el Se√±or, que estuvo por nosotros..."}, ot: {ref: "Isa√≠as 57:14-21", text: "Y se dir√°: Allanad, allanad; barred el camino..."}, nt: {ref: "Apocalipsis 3:14-22", text: "Y escribe al √°ngel de la iglesia en Laodicea..."} }
                }
            };
            const placeholderData = {
                collect: "La colecta para este d√≠a a√∫n no est√° disponible.",
                morning: { psalms: {ref: "Salmos", text: "A√∫n no disponible"}, ot: {ref: "Antiguo Testamento", text: "A√∫n no disponible"}, nt: {ref: "Nuevo Testamento", text: "A√∫n no disponible"} },
                evening: { psalms: {ref: "Salmos", text: "A√∫n no disponible"}, ot: {ref: "Antiguo Testamento", text: "A√∫n no disponible"}, nt: {ref: "Nuevo Testamento", text: "A√∫n no disponible"} }
            };

            function renderLectionaryInterface() {
                const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
                monthSelector.innerHTML = '';
                monthNames.forEach((name, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = name;
                    monthSelector.appendChild(option);
                });

                monthSelector.addEventListener('change', (e) => {
                    const monthIndex = parseInt(e.target.value);
                    renderCalendarForMonth(monthIndex);
                });

                const currentMonth = new Date().getMonth();
                monthSelector.value = currentMonth;
                renderCalendarForMonth(currentMonth);
            }

            function renderCalendarForMonth(monthIndex) {
                const year = 2025;
                const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
                currentMonthYear.textContent = `${monthNames[monthIndex]} ${year}`;
                
                lectionaryDayGridContainer.innerHTML = '';
                const grid = document.createElement('div');
                grid.className = "lectionary-calendar-grid";

                const dayHeaders = ["Dom", "Lun", "Mar", "Mi√©", "Jue", "Vie", "S√°b"];
                dayHeaders.forEach(day => {
                    const headerCell = document.createElement('div');
                    headerCell.className = 'calendar-header';
                    headerCell.textContent = day;
                    grid.appendChild(headerCell);
                });

                const firstDayOfMonth = new Date(year, monthIndex, 1).getDay();
                const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();

                for (let i = 0; i < firstDayOfMonth; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = "calendar-day empty";
                    grid.appendChild(emptyCell);
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, monthIndex, day);
                    const dateString = `${year}-${String(monthIndex + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    
                    const cell = document.createElement('button');
                    cell.className = "calendar-day";
                    if (lectionaryData[dateString]) {
                        cell.classList.add("has-data");
                    }
                    if (date.getDay() === 0) {
                        cell.classList.add("is-sunday");
                    }
                    cell.dataset.date = dateString;
                    cell.innerHTML = `<span class="day-number">${day}</span>`;
                    grid.appendChild(cell);
                }
                lectionaryDayGridContainer.appendChild(grid);
            }

            function showLectionaryPopup(dateString) {
                const data = lectionaryData[dateString] || placeholderData;
                displayPopupContent(dateString, data);
            }
            
            function displayPopupContent(dateString, data) {
                const [year, month, day] = dateString.split('-').map(Number);
                const date = new Date(year, month - 1, day);
                lectionaryPopupTitle.textContent = date.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

                const buildOfficeHtml = (title, readings, collect) => {
                    return `
                        <div class="office-section mb-8">
                            <h4 class="text-xl font-bold text-teal-700 border-b pb-2 mb-3">${title}</h4>
                            
                            <h5 class="font-bold">Apertura</h5>
                            <p class="liturgy-text"><em>Una de las siguientes Sentencias de la Escritura es le√≠da.</em></p>
                            <p class="liturgy-text">‚ÄúAs√≠ que hum√≠llense bajo la poderosa mano de Dios, para que √©l los exalte a su debido tiempo. Depositen en √©l toda ansiedad, porque √©l cuida de ustedes.‚Äù (1 Pedro 5:6-7)</p>
                            
                            <h5 class="font-bold">Confesi√≥n de Pecado</h5>
                            <p class="liturgy-text"><strong>Misericordios√≠simo Dios, confesamos que hemos pecado contra ti en pensamiento, palabra y obra, por lo que hemos hecho y por lo que hemos dejado de hacer. No te hemos amado con todo nuestro coraz√≥n; no hemos amado a nuestro pr√≥jimo como a nosotros mismos. Lo sentimos de veras y nos arrepentimos humildemente. Por tu Hijo Jesucristo, ten misericordia de nosotros y perd√≥nanos, para que nos deleitemos en tu voluntad y andemos en tus caminos, para la gloria de tu Nombre. Am√©n.</strong></p>
                             <p class="liturgy-text"><em>El Obispo o Sacerdote se pone de pie y dice</em><br>Dios todopoderoso tenga misericordia de ustedes, perdone todos sus pecados por nuestro Se√±or Jesucristo, los fortalezca en toda bondad, y por el poder del Esp√≠ritu Santo los guarde en vida eterna. <strong>Am√©n.</strong></p>
                            
                            <h5 class="font-bold">El Invitatorio</h5>
                            <p class="liturgy-text">Oficiante: Oh Se√±or, abre nuestros labios.<br><strong>Pueblo: Y nuestra boca proclamar√° tu alabanza.</strong></p>
                            <p class="liturgy-text"><strong>Gloria al Padre, y al Hijo, y al Esp√≠ritu Santo; como era en el principio, es ahora y siempre, por los siglos de los siglos. Am√©n.</strong></p>
                             <p class="liturgy-text"><em>Se dice o canta el Venite o el Himno Pascual.</em><br><strong>Venid, aclamemos al Se√±or con alegr√≠a; cantemos a la Roca que nos salva...</strong></p>

                            <h5 class="font-bold">Salmos del D√≠a: ${readings.psalms.ref}</h5>
                            <p class="liturgy-text">${readings.psalms.text}</p>
                            
                            <h5 class="font-bold">Las Lecciones</h5>
                            <p class="liturgy-text"><strong>Antiguo Testamento: ${readings.ot.ref}</strong><br>${readings.ot.text}</p>
                            <p class="liturgy-text"><em>Aqu√≠ el Lector puede decir:</em> La Palabra del Se√±or. <br><strong>Gracias a Dios.</strong></p>
                            <p class="liturgy-text"><strong>Nuevo Testamento: ${readings.nt.ref}</strong><br>${readings.nt.text}</p>
                             <p class="liturgy-text"><em>Aqu√≠ el Lector puede decir:</em> La Palabra del Se√±or. <br><strong>Gracias a Dios.</strong></p>
                            
                            <h5 class="font-bold">El Credo de los Ap√≥stoles</h5>
                            <p class="liturgy-text"><strong>Creo en Dios Padre todopoderoso, creador del cielo y de la tierra. Creo en Jesucristo, su √∫nico Hijo, nuestro Se√±or, que fue concebido por el Esp√≠ritu Santo, nacido de la virgen Mar√≠a, padeci√≥ bajo el poder de Poncio Pilato, fue crucificado, muerto y sepultado. Descendi√≥ a los infiernos. Al tercer d√≠a resucit√≥ de entre los muertos, subi√≥ a los cielos y est√° sentado a la diestra de Dios Padre todopoderoso. Desde all√≠ vendr√° a juzgar a vivos y muertos. Creo en el Esp√≠ritu Santo, la santa Iglesia cat√≥lica, la comuni√≥n de los santos, el perd√≥n de los pecados, la resurrecci√≥n del cuerpo y la vida eterna. Am√©n.</strong></p>

                            <h5 class="font-bold">Las Oraciones</h5>
                            <p class="liturgy-text">El Se√±or sea con ustedes.<br><strong>Y con tu esp√≠ritu.</strong><br>Oremos.</p>
                            <p class="liturgy-text"><strong>Padre nuestro que est√°s en los cielos, santificado sea tu Nombre, venga tu reino, h√°gase tu voluntad, en la tierra como en el cielo. Danos hoy nuestro pan de cada d√≠a. Y perd√≥nanos nuestras deudas, como tambi√©n nosotros perdonamos a nuestros deudores. Y no nos dejes caer en tentaci√≥n, mas l√≠branos del mal. Porque tuyo es el reino, y el poder, y la gloria, por siempre jam√°s. Am√©n.</strong></p>
                            
                            <h5 class="font-bold">La Colecta del D√≠a</h5>
                            <p class="liturgy-text">${collect}</p>
                            
                            <h5 class="font-bold">Acci√≥n de Gracias General</h5>
                            <p class="liturgy-text"><strong>Dios todopoderoso, Padre de toda misericordia, nosotros, tus indignos siervos, te damos muy humildes y sinceras gracias por toda tu bondad y tu amorosa amabilidad para con nosotros y para con todos los hombres. Te bendecimos por nuestra creaci√≥n, preservaci√≥n y todas las bendiciones de esta vida; pero sobre todo por tu inestimable amor en la redenci√≥n del mundo por nuestro Se√±or Jesucristo; por los medios de gracia y por la esperanza de la gloria. Y, te suplicamos, que nos des el debido sentido de todas tus misericordias, para que nuestros corazones sean agradecidos, y que mostremos tu alabanza, no solo con nuestros labios, sino en nuestras vidas, entreg√°ndonos a tu servicio y caminando ante ti en santidad y justicia todos nuestros d√≠as; por Jesucristo nuestro Se√±or, a quien, contigo y el Esp√≠ritu Santo, sea todo honor y gloria, por los siglos de los siglos. Am√©n.</strong></p>

                            <h5 class="font-bold">La Gracia</h5>
                            <p class="liturgy-text">La gracia de nuestro Se√±or Jesucristo, el amor de Dios y la comuni√≥n del Esp√≠ritu Santo sea con todos nosotros por siempre jam√°s. <strong>Am√©n.</strong> (2 Corintios 13:14)</p>
                        </div>
                    `;
                };

                const morningPrayerHtml = buildOfficeHtml("Oraci√≥n Matutina", data.morning, data.collect);
                const eveningPrayerHtml = buildOfficeHtml("Oraci√≥n Vespertina", data.evening, data.collect);

                lectionaryPopupBody.innerHTML = morningPrayerHtml + '<hr class="my-8 border-gray-300">' + eveningPrayerHtml;

                lectionaryPopupOverlay.classList.remove('hidden');
                lectionaryPopup.classList.remove('hidden');
                setTimeout(() => {
                    lectionaryPopupOverlay.classList.add('opacity-100');
                    lectionaryPopup.classList.add('scale-100');
                }, 10);
                document.body.style.overflow = 'hidden';
            }

            function closeLectionaryPopup() {
                lectionaryPopupOverlay.classList.remove('opacity-100');
                lectionaryPopup.classList.remove('scale-100');
                setTimeout(() => {
                    lectionaryPopupOverlay.classList.add('hidden');
                    lectionaryPopup.classList.add('hidden');
                    document.body.style.overflow = '';
                }, 300);
            }

            // --- EVENT LISTENERS ---
            Object.keys(mainNavButtons).forEach(key => {
                if(mainNavButtons[key]) {
                    mainNavButtons[key].addEventListener('click', () => switchView(key));
                }
            });

            backToCalendarBtn.addEventListener('click', hideFullLiturgy);
            printBtn.addEventListener('click', () => window.print());
            
            downloadDocxBtn.addEventListener('click', () => {
                const title = fullLiturgyUI.title.textContent;
                const subtitle = fullLiturgyUI.subtitle.textContent;
                const contentElement = document.getElementById('full-liturgy-content').cloneNode(true);

                contentElement.querySelectorAll('.ref-link').forEach(el => {
                    const sup = document.createElement('sup');
                    sup.textContent = el.textContent;
                    el.parentNode.replaceChild(sup, el);
                });

                const liturgyBody = contentElement.querySelector('.bg-white');
                if (!liturgyBody) {
                    console.error("Liturgy content body not found for DOCX export.");
                    return;
                }
                
                const headerHtml = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h1>${title}</h1>
                        <p><em>${subtitle}</em></p>
                    </div>
                `;

                const styles = `
                    <style>
                        body { font-family: 'Times New Roman', Times, serif; font-size: 10pt; }
                        h1 { font-size: 16pt; font-weight: bold; }
                        p { font-size: 12pt; }
                        h2 { font-size: 14pt; font-weight: bold; border-bottom: 1px solid #000; padding-bottom: 5px; margin-top: 20px; }
                        h3 { font-size: 11pt; font-weight: bold; margin-top: 15px; }
                        .liturgy-text { margin-top: 10px; }
                        strong { font-weight: bold; }
                        em, i { font-style: italic; }
                    </style>
                `;

                const twoColumnContent = `<div style="column-count: 2; column-gap: 40px;">${liturgyBody.innerHTML}</div>`;

                const fullHtmlForDocx = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        ${styles}
                    </head>
                    <body>
                        ${headerHtml}
                        ${twoColumnContent}
                    </body>
                    </html>
                `;

                try {
                    const converted = htmlDocx.asBlob(fullHtmlForDocx, {
                        orientation: 'landscape',
                        margins: { top: 720, right: 720, bottom: 720, left: 720 }
                    });
                    saveAs(converted, `${title}.docx`);
                } catch (error) {
                    console.error("Error generating DOCX file:", error);
                }
            });
            
            cardsContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.liturgical-card');
                if (card && card.dataset.date) {
                    const [year, month, day] = card.dataset.date.split('-').map(Number);
                    const selectedDate = new Date(year, month - 1, day);
                    showFullLiturgy(selectedDate);
                }
            });

            // --- THEOLOGY POPUP LISTENERS ---
            fullLiturgyView.addEventListener('click', showTheologyPopup);
            theologyPopupClose.addEventListener('click', closeTheologyPopup);
            theologyPopupOverlay.addEventListener('click', closeTheologyPopup);

            // --- LECTIONARY POPUP LISTENERS ---
            lectionaryDayGridContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.calendar-day');
                if (card && card.dataset.date) {
                    showLectionaryPopup(card.dataset.date);
                }
            });
            lectionaryPopupClose.addEventListener('click', closeLectionaryPopup);
            lectionaryPopupOverlay.addEventListener('click', closeLectionaryPopup);


            // --- LOGO UPLOAD LISTENERS ---
            uploadLogoBtn.addEventListener('click', () => logoUploader.click());

            logoUploader.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const logoDataUrl = e.target.result;
                        localStorage.setItem('userLogo', logoDataUrl);
                        logoImage.src = logoDataUrl;
                    }
                    reader.readAsDataURL(file);
                }
            });

            // --- HEADER SCROLL LOGIC ---
            let lastScrollTop = 0;
            const mainHeader = document.getElementById('main-header');
            window.addEventListener("scroll", function() {
                let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                if (scrollTop > lastScrollTop && scrollTop > mainHeader.offsetHeight) {
                    mainHeader.classList.add('header-hidden');
                } else {
                    mainHeader.classList.remove('header-hidden');
                }
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
            }, false);

            // --- MOBILE MENU LOGIC ---
            function openMobileMenu() {
                mobileMenu.classList.remove('menu-hidden');
                document.body.style.overflow = 'hidden';
            }

            function closeMobileMenu() {
                mobileMenu.classList.add('menu-hidden');
                document.body.style.overflow = '';
            }

            hamburgerBtn.addEventListener('click', openMobileMenu);
            closeMenuBtn.addEventListener('click', closeMobileMenu);
            mobileNavLinks.addEventListener('click', (e) => {
                if (e.target.matches('a.mobile-nav-link')) {
                    const view = e.target.dataset.view;
                    if (view) {
                        switchView(view);
                    }
                    closeMobileMenu();
                }
            });

            // --- INITIALIZATION ---
            function initializeApp() {
                setTimeout(() => {
                    splashScreen.classList.add('fade-out');
                    mainContent.classList.remove('opacity-0');
                    setTimeout(() => {
                        splashScreen.style.display = 'none';
                    }, 1500);
                }, 2000);

                loadLogoFromStorage();
                switchView('home');
                renderLiturgicalCards();
                renderLectionaryInterface();
            }
            initializeApp();
        });
    </script>
</body>
</html>
