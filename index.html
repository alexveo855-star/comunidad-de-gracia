<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IBCG APP - Liturgia 2025 (Ciclo C)</title>
    <!-- Favicon para Navegadores y Accesos Directos en MÃ³viles -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ•Šï¸%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ•Šï¸%3C/text%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html-docx-js/dist/html-docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
<style>
        @import url('https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400&family=Roboto:wght@400;500;700&display=swap');
        body {
            font-family: 'Merriweather', serif;
            background-image: url('https://www.bibleserver.com/build/bs-start-back-Dno9hVpC.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #433A3F; 
        }
        h1, h2, h3, h4, h5, h6, .nav-item, .filter-button, .main-nav-button {
            font-family: 'Roboto', sans-serif;
        }
        .liturgy-text {
            transition: all 0.3s ease-in-out;
            border-left: 4px solid transparent;
            padding-left: 1rem;
            margin-top: 1rem;
            line-height: 1.7; /* Slightly adjusted line height */
            font-size: 0.9rem; /* Base font size for mobile */
        }
        @media (min-width: 768px) {
            .liturgy-text {
                font-size: 1rem; /* Larger font size for desktop */
            }
        }
        #main-header {
            transition: transform 0.3s ease-in-out;
        }
        .header-hidden {
            transform: translateY(-100%);
        }
        .ref-link {
            cursor: pointer;
            font-weight: bold;
            /* The text color of the word itself is inherited */
            text-decoration: none;
            position: relative;
        }
        .ref-link sup {
            font-size: 0.7em;
            vertical-align: super;
            margin-left: 1px;
            font-weight: 900;
            color: #dc2626; /* red-600 */
        }
        
        /* --- Mobile-Optimized Popup/Modal Styles --- */
        #theology-popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(2px);
            z-index: 100;
        }
        #theology-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Center the popup */
            width: 90%;
            max-width: 450px; /* Slightly wider for more content */
            max-height: 80vh; /* Prevent it from being too tall */
            overflow-y: auto; /* Allow scrolling within the popup */
            background-color: white;
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            z-index: 110;
            font-family: 'Merriweather', serif;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #334155;
        }
        #theology-popup h5 {
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            color: #0d9488;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }
        #theology-popup .original-term {
            font-size: 1.5rem;
            font-family: 'Times New Roman', serif;
        }
        #popup-close {
            position: absolute;
            top: 0.5rem;
            right: 0.75rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #94a3b8;
            cursor: pointer;
            line-height: 1;
        }
        #popup-close:hover { color: #475569; }
        
        /* Full Screen Liturgy View Styles */
        #full-liturgy-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #FDFBF5; z-index: 100; overflow-y: auto;
        }
        .liturgy-section h2 {
            font-size: 1.25rem; /* Reduced for mobile */
            font-weight: 700; border-bottom: 2px solid #fBBF24; padding-bottom: 0.5rem; margin-bottom: 1.5rem; margin-top: 2.5rem; color: #1e293b;
        }
        .liturgy-section h3 {
            font-size: 1rem; /* Reduced for mobile */
            font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.5rem; color: #334155;
        }
        @media (min-width: 768px) {
            .liturgy-section h2 { font-size: 1.5rem; }
            .liturgy-section h3 { font-size: 1.1rem; }
        }
        
        /* --- NEW BIBLE VIEW STYLES --- */
        .bible-nav-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .bible-nav-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .bible-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
        }
        .bible-book-card, .bible-chapter-card {
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
        }
        /* Style for verse numbers */
        #chapter-content-view > p > sup:first-child { 
            font-size: 0.65em; vertical-align: super; color: #0f766e; font-weight: bold; margin-right: 0.2em; line-height: 1; 
        }
        .verse-wrapper {
            margin-bottom: 0.25rem;
            padding: 0.1rem 0;
            transition: background-color 0.2s;
            line-height: 1.9;
        }
        .has-commentary {
            background-color: #f0fdfa; /* teal-50 */
            border-left: 4px solid #14b8a6; /* teal-500 */
            padding: 0.5rem 1rem;
            margin: 0.5rem -1rem;
            border-radius: 8px;
        }

        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Splash Screen */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background-image: url('https://images.unsplash.com/photo-1489664942048-a3a60914a2f4?q=80&w=2070&auto=format&fit=crop');
            background-size: cover; background-position: center;
            z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; text-align: center;
            transition: opacity 1.5s ease-in-out;
            padding: 1rem;
        }
        #splash-screen.fade-out {
            opacity: 0;
        }
        .splash-title {
            font-family: 'Merriweather', serif;
            font-size: 2.5rem; sm:font-size: 3rem; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .splash-subtitle {
            font-family: 'Roboto', sans-serif;
            font-size: 1.1rem; sm:font-size: 1.25rem; margin-top: 0.5rem; text-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }

        /* Main Menu */
        .main-nav-button {
            padding: 0.5rem 0;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #4b5563; /* gray-600 */
            transition: all 0.2s ease-in-out;
            font-size: 0.875rem; sm:font-size: 1rem;
        }
        .main-nav-button:hover {
            color: #0d9488; /* teal-600 */
            border-bottom-color: #99f6e4; /* teal-200 */
        }
        .active-nav {
            color: #0f766e; /* teal-700 */
            font-weight: 700;
            border-bottom-color: #0f766e; /* teal-700 */
        }
        
        /* Liturgical Cards Styles */
        .liturgical-card {
            background-color: white;
            border-left-width: 6px;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .liturgical-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        /* Mobile Menu Transition */
        .menu-hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Print Styles */
        .print-only-header { display: none; }
        @media print {
            @page {
                size: letter landscape;
                margin: 1cm;
            }
            body, html { background-color: white !important; }
            body > *:not(#full-liturgy-view) { display: none; }
            #full-liturgy-view {
                position: static; width: auto; height: auto; overflow: visible; background-color: white !important;
            }
            #full-liturgy-header { display: none; }
            .print-only-header { display: block; text-align: center; margin-bottom: 1cm; break-after: avoid; }
            .print-title { font-size: 16pt; font-weight: bold; font-family: 'Times New Roman', Times, serif; }
            .print-subtitle { font-size: 12pt; font-style: italic; font-family: 'Times New Roman', Times, serif; }
            #full-liturgy-content { padding: 0; margin: 0; }
            .print-liturgy-body { column-count: 2; column-gap: 1.5cm; }
            .liturgy-section { break-inside: avoid; }
            .liturgy-section h2 { font-size: 14pt !important; color: black !important; border-bottom: 2px solid black; break-after: avoid; padding-top: 1em; }
            .liturgy-section:first-of-type h2 { padding-top: 0; }
            .liturgy-section h3 { font-size: 11pt !important; color: black !important; }
            body, .liturgy-text, p { font-family: 'Times New Roman', Times, serif; font-size: 10pt !important; color: black !important; background-color: white !important; }
            .ref-link { display: none; }
            #full-liturgy-content .bg-white { box-shadow: none; padding: 0; }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="menu-hidden fixed inset-0 bg-white z-50 flex flex-col items-center justify-center transition-opacity duration-300 ease-in-out">
        <button id="close-menu-btn" class="absolute top-5 right-5 text-gray-600 hover:text-gray-900 p-2">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
        <nav id="mobile-nav-links" class="flex flex-col items-center gap-8">
            <a data-view="home" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Inicio</a>
            <a data-view="liturgy" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Liturgia</a>
            <a data-view="bible" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Biblia</a>
            <a data-view="glossary" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Recursos</a>
            <a data-view="lectionary" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600 cursor-pointer">Leccionario</a>
            <a href="https://www.bibleserver.com/nicodemus-ai" target="_blank" rel="noopener noreferrer" class="mobile-nav-link text-2xl font-bold text-gray-700 hover:text-teal-600">Nicodemus IA</a>
        </nav>
    </div>

    <div id="splash-screen">
        <h1 class="splash-title">Comunidad de Gracia</h1>
        <p class="splash-subtitle">Liturgia y Recursos</p>
    </div>

    <div id="main-content" class="opacity-0 transition-opacity duration-500">
        <header id="main-header" class="bg-white/80 backdrop-blur-sm shadow-sm py-2 px-4 sticky top-0 z-20">
            <div class="container mx-auto flex justify-between items-center">
                <!-- Logo and Title -->
                <div class="flex items-center gap-3">
                    <img id="logo-image" src="https://scontent-mia3-1.xx.fbcdn.net/v/t39.30808-1/458442022_122107426106496454_2577487987417874050_n.jpg?stp=dst-jpg_s200x200_tt6&_nc_cat=111&ccb=1-7&_nc_sid=2d3e12&_nc_ohc=Zy1TV0kujjIQ7kNvwEz8bgt&_nc_oc=Adl4Yh0O1zq-mS8LlfMHzCmTKgBM-yzBhJyyNVnQtxBS9eQMVoKdbqWamxJjkk23f78&_nc_zt=24&_nc_ht=scontent-mia3-1.xx&_nc_gid=AuKzGmho4nnugwzcXEAx7A&oh=00_AfQLVtVuH2tLlf7fZE-otz8oogECgeQlPogoM7mnCAewGA&oe=68938DFE" onerror="this.onerror=null;this.src='https://placehold.co/100x100/3A5F7D/FFFFFF?text=Logo';" alt="Logo Comunidad de Gracia" class="h-10 w-auto rounded-full">
                    <h1 class="text-lg sm:text-xl font-bold text-gray-800">IBCG APP</h1>
                </div>
                <!-- Desktop Navigation Buttons -->
                <nav class="hidden lg:flex flex-wrap justify-center items-center gap-x-3 sm:gap-x-4 md:gap-x-6">
                    <a id="btn-home" class="main-nav-button cursor-pointer">Inicio</a>
                    <a id="btn-liturgy" class="main-nav-button cursor-pointer">Liturgia</a>
                    <a id="btn-bible" class="main-nav-button cursor-pointer">Biblia</a>
                    <a id="btn-glossary" class="main-nav-button cursor-pointer">Recursos</a>
                    <a id="btn-lectionary" class="main-nav-button cursor-pointer">Leccionario</a>
                    <a href="https://www.bibleserver.com/nicodemus-ai" target="_blank" rel="noopener noreferrer" class="main-nav-button">Nicodemus IA</a>
                    <a id="btn-upload-logo" class="main-nav-button cursor-pointer">
                        <svg class="w-6 h-6 text-gray-600 hover:text-teal-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    </a>
                </nav>
                <!-- Mobile Menu Button -->
                <div class="lg:hidden flex items-center">
                    <button id="hamburger-btn" class="p-2 rounded-md text-gray-600 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-teal-500">
                        <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <input type="file" id="logo-uploader" class="hidden" accept="image/*">

        <div id="home-view" class="min-h-[85vh]">
            <!-- This div is intentionally empty to show the body background -->
        </div>

        <div id="liturgy-view" class="hidden">
            <main class="container mx-auto p-4">
                <div class="bg-white/80 backdrop-blur-sm p-4 sm:p-6 rounded-lg shadow-2xl">
                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 text-center border-b-2 border-amber-400 pb-3">Calendario LitÃºrgico 2025</h2>
                    <div id="liturgical-cards-container" class="space-y-4">
                        <!-- Liturgical cards will be inserted here by JavaScript -->
                    </div>
                </div>
            </main>
        </div>

        <div id="bible-view" class="hidden">
            <main class="container mx-auto p-4">
                <div id="bible-header" class="bg-white/80 backdrop-blur-sm p-4 rounded-lg shadow-md mb-6">
                     <div class="flex items-center">
                        <button id="bible-back-btn" class="hidden mr-4 text-gray-600 hover:text-gray-900 p-2 rounded-full hover:bg-gray-200">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </button>
                        <h2 id="bible-view-title" class="text-xl sm:text-2xl font-bold text-gray-800">Biblia</h2>
                     </div>
                </div>
        
                <div id="bible-navigation-content">
                    <!-- 1. Testament Selection -->
                    <div id="testament-selector-view" class="fade-in">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div id="select-ot" class="bible-nav-card cursor-pointer bg-white/80 backdrop-blur-sm p-8 rounded-lg shadow-lg text-center">
                                <h3 class="text-2xl font-bold text-teal-800">Antiguo Testamento</h3>
                            </div>
                            <div id="select-nt" class="bible-nav-card cursor-pointer bg-white/80 backdrop-blur-sm p-8 rounded-lg shadow-lg text-center">
                                <h3 class="text-2xl font-bold text-teal-800">Nuevo Testamento</h3>
                            </div>
                        </div>
                    </div>
        
                    <!-- 2. Book Selection -->
                    <div id="book-selector-view" class="hidden fade-in bible-grid">
                        <!-- Book cards will be injected here -->
                    </div>
        
                    <!-- 3. Chapter Selection -->
                    <div id="chapter-selector-view" class="hidden fade-in bible-grid">
                         <!-- Chapter cards will be injected here -->
                    </div>
        
                    <!-- 4. Chapter Content -->
                    <div id="chapter-content-view" class="hidden fade-in bg-white/80 backdrop-blur-sm p-6 rounded-lg shadow-inner max-w-none">
                         <!-- Chapter text will be injected here -->
                    </div>
                </div>
            </main>
        </div>

        <div id="glossary-view" class="hidden">
            <main class="container mx-auto p-4 md:p-8">
                <div class="bg-white/80 backdrop-blur-sm p-6 sm:p-8 rounded-lg shadow-lg">
                    <h2 class="text-2xl sm:text-3xl font-bold border-b-2 border-amber-400 pb-2 mb-6 text-gray-800">ACNA: Libro de OraciÃ³n ComÃºn y Recursos</h2>
                    <div class="mt-8 text-center bg-stone-100 p-6 sm:p-8 rounded-lg shadow">
                        <p class="text-lg text-gray-700 mb-4">Para acceder a los recursos del Libro de OraciÃ³n ComÃºn, por favor haz clic en el siguiente botÃ³n. El sitio se abrirÃ¡ en una nueva pestaÃ±a del navegador.</p>
                        <a href="https://bcp2019.anglicanchurch.net/index.php/downloads-espanol/" target="_blank" rel="noopener noreferrer" class="inline-block bg-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-700 transition-colors shadow-md">
                            Ir a Recursos ACNA
                        </a>
                    </div>
                </div>
            </main>
        </div>

        <div id="lectionary-view" class="hidden">
            <main class="container mx-auto p-4 md:p-8 flex items-center justify-center min-h-[85vh]">
                <div class="w-full max-w-2xl bg-white/80 backdrop-blur-sm p-6 sm:p-8 rounded-lg shadow-lg">
                    <h2 class="text-2xl sm:text-3xl font-bold border-b-2 border-amber-400 pb-2 mb-6 text-gray-800">Leccionario Diario 2025</h2>
                    <div class="mt-8 text-center bg-stone-100 p-6 sm:p-8 rounded-lg shadow">
                        <p class="text-lg text-gray-700 mb-6">El Leccionario Diario se abrirÃ¡ en una nueva pestaÃ±a del navegador para una mejor experiencia de visualizaciÃ³n.</p>
                        <a href="https://liturgical-calendar.com/es/ACNA2019/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-3 bg-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-700 transition-colors shadow-md">
                            <span>Abrir Leccionario</span>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                        </a>
                    </div>
                </div>
            </main>
        </div>
        
        <footer class="bg-gray-800/90 text-white py-6 px-4">
            <div class="container mx-auto text-center">
                <div class="flex justify-center space-x-6 mb-4">
                    <!-- Facebook Icon -->
                    <a href="#" class="text-gray-400 hover:text-white transition-colors" aria-label="Facebook">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33V21.878C18.343 21.128 22 16.991 22 12z" />
                        </svg>
                    </a>
                    <!-- Instagram Icon -->
                    <a href="#" class="text-gray-400 hover:text-white transition-colors" aria-label="Instagram">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.024.06 1.378.06 3.808s-.012 2.784-.06 3.808c-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.024.048-1.378.06-3.808.06s-2.784-.012-3.808-.06c-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.048-1.024-.06-1.378-.06-3.808s.012-2.784.06-3.808c.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 016.08 2.525c.636-.247 1.363-.416 2.427-.465C9.53 2.013 9.884 2 12.315 2zM12 0C9.81 0 9.448.01 8.378.058c-1.11.05-1.897.227-2.613.51a6.888 6.888 0 00-2.15 1.417A6.888 6.888 0 002.2 4.135c-.283.716-.46 1.503-.51 2.613C1.632 7.795 1.62 8.157 1.62 10.647s.012 2.852.058 3.922c.05 1.11.227 1.897.51 2.613a6.888 6.888 0 001.417 2.15 6.888 6.888 0 002.15 1.417c.716.283 1.503.46 2.613.51 1.07.048 1.432.058 3.922.058s2.852-.01 3.922-.058c1.11-.05 1.897-.227 2.613-.51a6.888 6.888 0 002.15-1.417 6.888 6.888 0 001.417-2.15c.283-.716.46-1.503.51-2.613.048-1.07.058-1.432.058-3.922s-.01-2.852-.058-3.922c-.05-1.11-.227-1.897-.51-2.613a6.888 6.888 0 00-1.417-2.15A6.888 6.888 0 0018.865 2.2c-.716-.283-1.503-.46-2.613-.51C15.182.01 14.82 0 12.315 0z" clip-rule="evenodd" />
                            <path d="M16.95 6.402a1.25 1.25 0 100-2.5 1.25 1.25 0 000 2.5zM12 8.26a3.74 3.74 0 100 7.48 3.74 3.74 0 000-7.48zM12 13.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z" />
                        </svg>
                    </a>
                    <!-- TikTok Icon -->
                    <a href="#" class="text-gray-400 hover:text-white transition-colors" aria-label="TikTok">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-2.43.05-4.86-.95-6.69-2.79-1.75-1.75-2.81-4.15-2.8-6.6.01-2.33 1.01-4.6 2.66-6.21 1.72-1.68 4.06-2.63 6.4-2.66.12-2.17.1-4.34.01-6.51z" />
                        </svg>
                    </a>
                    <!-- X (Twitter) Icon -->
                    <a href="#" class="text-gray-400 hover:text-white transition-colors" aria-label="X">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
                        </svg>
                    </a>
                </div>
                <p>&copy; 2025 IBCG APP. Todos los derechos reservados.</p>
                <p class="text-sm text-gray-400 mt-2">Textos litÃºrgicos del Misal Romano. Textos bÃ­blicos de la Conferencia Episcopal EspaÃ±ola.</p>
            </div>
        </footer>
    </div>

    <div id="full-liturgy-view" class="hidden">
        <header id="full-liturgy-header" class="sticky top-0 bg-white/95 backdrop-blur-sm shadow-md z-10">
            <div class="container mx-auto flex items-center justify-between p-2 sm:p-4">
                <button id="back-to-calendar-btn" title="Volver al calendario" class="flex-shrink-0 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    <span class="hidden sm:inline font-semibold text-base">Volver</span>
                </button>
                <div class="flex-grow text-center min-w-0 px-2">
                    <h1 id="full-liturgy-title" class="text-sm sm:text-base md:text-lg font-bold text-gray-800 truncate"></h1>
                    <p id="full-liturgy-subtitle" class="text-xs text-gray-600 truncate"></p>
                </div>
                <div class="flex-shrink-0 flex items-center gap-2 sm:gap-4">
                    <button id="download-docx-btn" title="Descargar como DOCX" class="text-gray-600 hover:text-gray-900 transition-colors p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                    </button>
                    <button id="print-btn" title="Imprimir Liturgia" class="text-gray-600 hover:text-gray-900 transition-colors p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                    </button>
                </div>
            </div>
        </header>
        <main id="full-liturgy-content" class="container mx-auto p-4 md:p-8">
            
</main>
    </div>

    <!-- Mobile-Optimized Popup -->
    <div id="theology-popup-overlay"></div>
    <div id="theology-popup">
        <span id="popup-close">&times;</span>
        <div id="popup-content-theology"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- HELPER FUNCTIONS ---
            const addDays = (d, days) => { const res = new Date(d); res.setDate(d.getDate() + days); return res; };
            const placeholderChapter = (numChapters) => Array.from({ length: numChapters }, (_, i) => [{ verse: 1, text: `[Texto del capÃ­tulo ${i + 1} no cargado para optimizar el rendimiento.]` }]);

            // --- THEOLOGICAL DATA & HELPERS (GLOBAL SCOPE) ---
            const terms = {
                // Terms for Liturgy
                hypostasis: {original: "á½‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ¹Ï‚", transliteration: "hypÃ³stasis", meaning: "Sustancia, fundamento, garantÃ­a. En este contexto, la fe es la realidad fundamental de lo que se espera."},
                elenchos: {original: "á¼”Î»ÎµÎ³Ï‡Î¿Ï‚", transliteration: "Ã©lenchos", meaning: "Prueba, convicciÃ³n. La fe proporciona una certeza interior sobre realidades que no se ven."},
                epangelia: {original: "á¼Ï€Î±Î³Î³ÎµÎ»Î¯Î±", transliteration: "epangelÃ­a", meaning: "Promesa. Un compromiso divino que es el objeto de la esperanza y la fe del creyente."},
                poimnion: {original: "Ï€Î¿Î¯Î¼Î½Î¹Î¿Î½", transliteration: "poÃ­mnion", meaning: "RebaÃ±o pequeÃ±o. TÃ©rmino de cariÃ±o y ternura que JesÃºs usa para sus discÃ­pulos, destacando su vulnerabilidad y la protecciÃ³n de Dios."},
                kardia: {original: "ÎºÎ±ÏÎ´Î¯Î±", transliteration: "kardÃ­a", meaning: "CorazÃ³n. En la Biblia, no es solo el asiento de las emociones, sino el centro del intelecto, la voluntad y toda la persona."},
                gregoreÅ: {original: "Î³ÏÎ·Î³Î¿ÏÎ­Ï‰", transliteration: "grÄ“goreÅ", meaning: "Velar, estar despierto. Una actitud de alerta espiritual y preparaciÃ³n constante para la venida del SeÃ±or."},
                doulos: {original: "Î´Î¿á¿¦Î»Î¿Ï‚", transliteration: "doÃ»los", meaning: "Siervo, esclavo. Describe la total devociÃ³n y obediencia a un amo; en el Nuevo Testamento, se usa para la relaciÃ³n del creyente con Cristo."},
                // Terms for Genesis 1
                bara: { original: "×‘Ö¸Ö¼×¨Ö¸×", transliteration: "bÄrÄ'", meaning: "Verbo hebreo exclusivo para la acciÃ³n creadora de Dios. Implica una creaciÃ³n desde la nada (ex nihilo), sin materia preexistente, y denota una acciÃ³n soberana y sin esfuerzo.", commentary: "<strong>Catecismo de la Iglesia CatÃ³lica (CIC 296):</strong> 'Creemos que Dios no necesita nada preexistente ni ninguna ayuda para crear. La creaciÃ³n tampoco es una emanaciÃ³n necesaria de la sustancia divina. Dios crea libremente â€œde la nadaâ€'. Esta doctrina es fundamental para entender la total soberanÃ­a y trascendencia de Dios." },
                tohu: { original: "×ªÖ¹×”×•Ö¼ ×•Ö¸×‘Ö¹×”×•Ö¼", transliteration: "tÅhÃ» wÄ-á¸‡ÅhÃ»", meaning: "'Caos y vacÃ­o' o 'sin forma y vacÃ­a'. Describe un estado de desorden primordial, una materia sin estructura que la Palabra de Dios ordenarÃ¡ y llenarÃ¡.", commentary: "<strong>San AgustÃ­n, Confesiones (Libro XII):</strong> AgustÃ­n interpreta esta 'materia informe' no como algo co-eterno con Dios, sino como la primera creaciÃ³n de Dios, la potencialidad pura que luego es formada y ordenada. No es un mal, sino la ausencia de bien (forma, orden)." },
                ruach: { original: "×¨×•Ö¼×—Ö· ×Ö±×œÖ¹×”Ö´×™×", transliteration: "rÃ»aá¸¥ â€™Ä•lÅhÃ®m", meaning: "'EspÃ­ritu de Dios' o 'Viento de Dios'. La palabra 'ruach' puede significar aliento, viento o espÃ­ritu. AquÃ­ representa la presencia dinÃ¡mica y vivificante de Dios sobre la creaciÃ³n incipiente.", commentary: "<strong>Joseph Ratzinger (Benedicto XVI), 'En el principio creÃ³ Dios':</strong> 'El EspÃ­ritu Santo es el poder por el que Dios obra... La creaciÃ³n es obra de la Trinidad. El Padre es la fuente, el Hijo (la Palabra) da la forma, y el EspÃ­ritu Santo es el poder que la realiza y la llena de vida.'" },
                yom: { original: "×™×•Ö¹×", transliteration: "yÃ´m", meaning: "'DÃ­a'. Su interpretaciÃ³n es compleja. Puede referirse a un dÃ­a literal de 24 horas, a una era o perÃ­odo de tiempo indefinido, o a un marco literario para estructurar la narrativa de la creaciÃ³n.", commentary: "<strong>CIC 337:</strong> 'Nada se opone a que la Sagrada Escritura describa la obra de la creaciÃ³n con la forma literaria de una sucesiÃ³n de seis dÃ­as.' La Iglesia no se pronuncia sobre la interpretaciÃ³n cientÃ­fica de la duraciÃ³n, pero afirma el orden y la bondad de todo lo creado por Dios, y que la creaciÃ³n culmina en el descanso del sÃ©ptimo dÃ­a." },
                tzelem: { original: "×¦Ö¶×œÖ¶× ×Ö±×œÖ¹×”Ö´×™×", transliteration: "á¹£elem â€™Ä•lÅhÃ®m", meaning: "'Imagen de Dios'. El ser humano es creado a imagen y semejanza de Dios. Esto no se refiere a una semejanza fÃ­sica, sino a la capacidad de razÃ³n, libre albedrÃ­o, amor y comuniÃ³n, que refleja la naturaleza de Dios.", commentary: "<strong>San Juan Pablo II, TeologÃ­a del Cuerpo:</strong> 'Ser imagen de Dios significa que el hombre es un ser capaz de entrar en relaciÃ³n. La comuniÃ³n de personas (AdÃ¡n y Eva) refleja la comuniÃ³n de Personas en la Trinidad. La dignidad humana reside en esta capacidad de amar y ser amado, de conocer y de elegir libremente el bien.'" },
                // Terms for Genesis 2
                shabbat: { original: "×©Ö¸××‘Ö·×ª", transliteration: "Å¡Äá¸‡aá¹¯", meaning: "'CesÃ³', 'descansÃ³'. Es la raÃ­z del Sabbat. El descanso de Dios no es por cansancio, sino la culminaciÃ³n de su obra, entrando en la perfecciÃ³n y plenitud de lo creado.", commentary: "<strong>CIC 345, 2168:</strong> El sÃ©ptimo dÃ­a es la bendiciÃ³n y santificaciÃ³n del tiempo. Para el hombre, el Sabbat es una invitaciÃ³n a participar en el descanso de Dios, a cesar del trabajo servil y a dedicar tiempo a la adoraciÃ³n y a la comuniÃ³n con Dios y la familia. Jesucristo es el SeÃ±or del Sabbat, y su ResurrecciÃ³n en el 'octavo dÃ­a' inaugura el nuevo Sabbat cristiano: el Domingo, el DÃ­a del SeÃ±or." },
                adamah: { original: "×Ö²×“Ö¸×Ö¸×”", transliteration: "â€™Äƒá¸ÄmÄh", meaning: "'Suelo', 'tierra'. El hombre (×Ö¸×“Ö¸×, 'ÄdÄm) es formado del suelo, destacando su conexiÃ³n con la tierra y su humildad material.", commentary: "Esta conexiÃ³n subraya tanto la fragilidad humana ('polvo eres y al polvo volverÃ¡s', GÃ©nesis 3:19) como su dignidad. El hombre es el puente entre lo terrenal (su cuerpo) y lo divino (el aliento de vida de Dios). Es el custodio de la creaciÃ³n, no su dueÃ±o absoluto." },
                neshamah: { original: "× Ö´×©Ö°××Ö·×ª ×—Ö·×™Ö´Ö¼×™×", transliteration: "niÅ¡maá¹¯ á¸¥ayyÃ®m", meaning: "'Aliento de vida'. Es el soplo divino que anima la materia y hace del hombre un ser viviente, un 'alma viviente' (nefesh hayyah).", commentary: "<strong>CIC 362:</strong> 'El relato bÃ­blico expresa esta realidad con un lenguaje simbÃ³lico cuando afirma que â€œDios formÃ³ al hombre con polvo del suelo e insuflÃ³ en sus narices aliento de vida y resultÃ³ el hombre un ser vivienteâ€. El alma humana es creada directamente por Dios; no es â€œproducidaâ€ por los padres.'" },
                ganeden: { original: "×’Ö·Ö¼×ŸÖ¾×‘Ö°Ö¼×¢Öµ×“Ö¶×Ÿ", transliteration: "gan-beâ€˜Ä’á¸en", meaning: "'JardÃ­n en EdÃ©n'. EdÃ©n significa 'delicia' o 'placer'. No es solo un lugar geogrÃ¡fico, sino un estado de armonÃ­a original con Dios, con la creaciÃ³n y dentro del propio ser humano.", commentary: "El JardÃ­n de EdÃ©n simboliza el estado de 'justicia original' en el que el hombre fue creado: libre de la concupiscencia, en amistad Ã­ntima con Dios, y en perfecta armonÃ­a. La presencia de los dos Ã¡rboles indica que la libertad humana, desde el principio, estÃ¡ intrÃ­nsecamente ligada a la ley moral y a la relaciÃ³n con el Creador." },
                ezerkenegdo: { original: "×¢Öµ×–Ö¶×¨ ×›Ö°Ö¼× Ö¶×’Ö°×“Ö¼×•Ö¹", transliteration: "â€˜Ä“zer kÉ™negdÃ´", meaning: "'Ayuda idÃ³nea' o 'ayuda correspondiente a Ã©l'. 'Ezer' es ayuda (a menudo usada para Dios como ayudador de Israel) y 'kenegdo' significa 'frente a Ã©l', 'correspondiente a Ã©l'. No implica subordinaciÃ³n, sino una complementariedad esencial.", commentary: "<strong>San Juan Pablo II, Mulieris Dignitatem:</strong> 'La mujer es otro â€œyoâ€ en la comÃºn humanidad. Desde el principio son â€œunidad de los dosâ€... Esto indica una relaciÃ³n de reciprocidad, donde ambos son un don el uno para el otro. La mujer ayuda al hombre a ser hombre, y el hombre ayuda a la mujer a ser mujer, encontrando ambos su plenitud en la comuniÃ³n de personas.'" },
                // Terms for Genesis 9
                nefesh: { original: "× Ö¶×¤Ö¶×©× ×—Ö·×™Ö¸Ö¼×”", transliteration: "nefeÅ¡ á¸¥ayyÄh", meaning: "'Ser viviente' o 'alma viviente'. Se refiere a la vida animada, tanto humana como animal. La sangre es considerada el asiento de esta vida.", commentary: "<strong>CIC 2260:</strong> 'El pacto de Dios con la humanidad estÃ¡ tejido con la consideraciÃ³n de la vida... La prohibiciÃ³n de derramar la sangre de un animal (GÃ©nesis 9:4) expresa que la vida es sagrada y pertenece a Dios. El mandamiento de no matar a un ser humano (GÃ©nesis 9:5-6) se basa en la dignidad suprema del hombre, creado a imagen de Dios.'" },
                berit: { original: "×‘Ö°Ö¼×¨Ö´×™×ª", transliteration: "berÃ®á¹¯", meaning: "'Pacto' o 'Alianza'. Un acuerdo solemne y vinculante. En este contexto, no es un contrato entre iguales, sino un compromiso unilateral de Dios con toda la creaciÃ³n.", commentary: "<strong>Joseph Ratzinger (Benedicto XVI), 'En el principio creÃ³ Dios':</strong> 'El pacto noÃ©ico es universal. Precede a las alianzas particulares con Abraham e Israel y abarca a toda la humanidad y a la creaciÃ³n entera. Es la base de la paciencia de Dios con la historia humana, una promesa de que nunca mÃ¡s destruirÃ¡ el mundo por agua, estableciendo un orden cÃ³smico estable donde la vida puede florecer.'" },
                qeshet: { original: "×§Ö¶×©Ö¶××ª", transliteration: "qeÅ¡eá¹¯", meaning: "'Arco'. La misma palabra hebrea para el arco de guerra. Dios cuelga su arma de guerra en las nubes como seÃ±al de paz y del fin de la hostilidad divina hacia la tierra.", commentary: "<strong>Nahum M. Sarna, 'Understanding Genesis':</strong> 'El simbolismo es profundo: el arma del guerrero divino se transforma en un signo de reconciliaciÃ³n. El arco, ahora apuntando lejos de la tierra, ya no es una amenaza, sino un recordatorio perpetuo de la promesa de gracia de Dios. Cada vez que aparece el arcoÃ­ris, es una manifestaciÃ³n visible del pacto divino.'" },
                // Terms for Genesis 10
                goyim: { original: "×’Ö¼×•Ö¹×™Ö´×", transliteration: "gÃ´yim", meaning: "'Naciones', 'pueblos'. Originalmente se referÃ­a a los pueblos no israelitas (gentiles), pero aquÃ­ se usa en un sentido universal para describir a toda la humanidad descendiente de NoÃ©.", commentary: "<strong>CIC 56:</strong> 'La alianza con NoÃ© despuÃ©s del diluvio expresa el principio de la economÃ­a divina con las Â«nacionesÂ». Esta alianza, vÃ¡lida mientras dura el tiempo de las naciones, testimonia que Dios quiere la unidad de toda la raza humana en su diversidad de pueblos, culturas y lenguas.'" },
                lashon: { original: "×œÖ¸×©××•Ö¹×Ÿ", transliteration: "lÄÅ¡Ã´n", meaning: "'Lengua', 'idioma'. La diversidad de lenguas se presenta aquÃ­ como parte del orden natural de la dispersiÃ³n de la humanidad, antes del juicio de Babel en el capÃ­tulo 11.", commentary: "Este capÃ­tulo presenta la diversidad como una bendiciÃ³n y un cumplimiento del mandato de 'llenar la tierra'. La teologÃ­a posterior, especialmente despuÃ©s de PentecostÃ©s (Hechos 2), verÃ¡ la reunificaciÃ³n de las lenguas no en una uniformidad, sino en una comprensiÃ³n mutua a travÃ©s del EspÃ­ritu Santo, celebrando la unidad en la diversidad." },
                nimrod: { original: "× Ö´×Ö°×¨×•Ö¹×“", transliteration: "NimrÃ´á¸", meaning: "El nombre significa 'nos rebelaremos'. Es una figura poderosa y ambigua, fundador de grandes imperios en Mesopotamia, incluyendo Babel. La tradiciÃ³n judÃ­a a menudo lo ve como un tirano que se rebelÃ³ contra Dios.", commentary: "<strong>San AgustÃ­n, 'La Ciudad de Dios' (Libro XVI):</strong> AgustÃ­n interpreta a Nimrod y la fundaciÃ³n de Babel como el arquetipo de la 'ciudad terrenal', que busca la gloria para sÃ­ misma en oposiciÃ³n a la 'Ciudad de Dios'. Nimrod, el 'cazador delante del SeÃ±or', es visto no como alguien que caza para Dios, sino como uno que desafÃ­a a Dios en su propia cara. Su reino representa el orgullo humano y el deseo de poder que culminarÃ¡ en la construcciÃ³n de la Torre de Babel." },
                // Terms for Genesis 11
                saphah: { original: "×©Ö¸×‚×¤Ö¸×”", transliteration: "Å›ÄpÌ„Äh", meaning: "'Lengua', 'labio', 'idioma'. AquÃ­ se usa junto con 'palabras' para enfatizar una unidad total de comunicaciÃ³n y propÃ³sito entre los hombres.", commentary: "<strong>Joseph Ratzinger (Benedicto XVI), 'En el principio creÃ³ Dios':</strong> 'La unidad de lengua no es solo un hecho lingÃ¼Ã­stico, sino la expresiÃ³n de una unidad espiritual y de una voluntad comÃºn. Esta unidad, sin embargo, se vuelve peligrosa cuando se dirige hacia un proyecto de auto-glorificaciÃ³n y autosuficiencia que excluye a Dios, como en Babel.'" },
                lebenah: { original: "×œÖ°×‘Öµ× Ö¸×”", transliteration: "leá¸‡Ä“nÄh", meaning: "'Ladrillo'. A diferencia de la piedra, que es una creaciÃ³n natural de Dios, el ladrillo es un producto de la tecnologÃ­a humana. Su uso aquÃ­ es significativo.", commentary: "El texto subraya que usaron ladrillo 'en lugar de piedra' y asfalto 'en lugar de mortero'. Esto representa un intento de construir una civilizaciÃ³n basada en la invenciÃ³n humana, independiente de los materiales provistos por el Creador. Es un sÃ­mbolo de la autosuficiencia que busca reemplazar la dependencia de Dios por la confianza en la propia capacidad tÃ©cnica." },
                babel: { original: "×‘Ö¸Ö¼×‘Ö¶×œ", transliteration: "BÄá¸‡el", meaning: "El nombre de la ciudad, que en acadio (BÄb-ili) significa 'Puerta de Dios', es reinterpretado irÃ³nicamente en hebreo a partir del verbo 'bÄlal', que significa 'confundir'.", commentary: "<strong>CIC 57:</strong> 'La torre de Babel, sÃ­mbolo de la soberbia colectiva, es el reverso de PentecostÃ©s. La confusiÃ³n de lenguas castiga el orgullo del hombre que intenta construir la unidad por sus propias fuerzas. En PentecostÃ©s, el EspÃ­ritu Santo crea la unidad en la diversidad, permitiendo que todos entiendan el Ãºnico Evangelio en su propia lengua. Babel es la deconstrucciÃ³n; PentecostÃ©s es la reconstrucciÃ³n en Cristo.'" }
            };
            const ref = (key, num) => `<span class="ref-link" data-term='${JSON.stringify(terms[key]).replace(/'/g, "&#39;")}'><sup>${num}</sup></span>`;

            // --- COMPLETE BIBLE DATA (VERIFIED WITH VATICAN.VA) ---
            const bibleData = [
                // Old Testament - 46 Books
                {
                    name: "GÃ©nesis",
                    testament: "OT",
                    chapters: [
                        // CapÃ­tulo 1 (con teologÃ­a)
                        [
                            { verse: 1, text: `En el principio creÃ³ ${ref('bara', 1)} Dios los cielos y la tierra.` },
                            { verse: 2, text: `La tierra era un caos informe y vacÃ­o ${ref('tohu', 2)}, y la oscuridad cubrÃ­a el abismo, mientras un viento de Dios ${ref('ruach', 3)} se cernÃ­a sobre las aguas.` },
                            { verse: 3, text: `Dijo Dios: Â«Haya luzÂ», y hubo luz.` },
                            { verse: 4, text: `Vio Dios que la luz era buena, y separÃ³ Dios la luz de la oscuridad.` },
                            { verse: 5, text: `LlamÃ³ Dios a la luz Â«DÃ­aÂ» ${ref('yom', 4)}, y a la oscuridad llamÃ³ Â«NocheÂ». PasÃ³ una tarde, pasÃ³ una maÃ±ana: el dÃ­a primero.` },
                            { verse: 6, text: `Dijo Dios: Â«Haya un firmamento entre las aguas, que separe aguas de aguasÂ».` },
                            { verse: 7, text: `Hizo Dios el firmamento y separÃ³ las aguas de debajo del firmamento de las aguas de encima del firmamento. Y asÃ­ fue.` },
                            { verse: 8, text: `LlamÃ³ Dios al firmamento Â«CieloÂ». PasÃ³ una tarde, pasÃ³ una maÃ±ana: el dÃ­a segundo.` },
                            { verse: 9, text: `Dijo Dios: Â«JÃºntense las aguas de debajo de los cielos en un solo lugar, y que aparezca lo secoÂ». Y asÃ­ fue.` },
                            { verse: 10, text: `LlamÃ³ Dios a lo seco Â«TierraÂ», y a la masa de las aguas llamÃ³ Â«MarÂ». Y vio Dios que era bueno.` },
                            { verse: 11, text: `Dijo Dios: Â«Produzca la tierra vegetaciÃ³n: hierbas que den semilla y Ã¡rboles frutales que den fruto segÃºn su especie, con su semilla dentro, sobre la tierraÂ». Y asÃ­ fue.` },
                            { verse: 12, text: `La tierra produjo vegetaciÃ³n: hierbas que dan semilla segÃºn su especie, y Ã¡rboles que dan fruto con su semilla dentro, segÃºn su especie. Y vio Dios que era bueno.` },
                            { verse: 13, text: `PasÃ³ una tarde, pasÃ³ una maÃ±ana: el dÃ­a tercero.` },
                            { verse: 14, text: `Dijo Dios: Â«Haya lumbreras en el firmamento del cielo para separar el dÃ­a de la noche, y que sirvan de seÃ±ales para las fiestas, los dÃ­as y los aÃ±os;` },
                            { verse: 15, text: `y que sirvan de lumbreras en el firmamento del cielo para alumbrar sobre la tierraÂ». Y asÃ­ fue.` },
                            { verse: 16, text: `Hizo Dios las dos grandes lumbreras: la lumbrera mayor para regir el dÃ­a, y la lumbrera menor para regir la noche; y las estrellas.` },
                            { verse: 17, text: `Las puso Dios en el firmamento del cielo para alumbrar sobre la tierra,` },
                            { verse: 18, text: `para regir el dÃ­a y la noche, y para separar la luz de la oscuridad. Y vio Dios que era bueno.` },
                            { verse: 19, text: `PasÃ³ una tarde, pasÃ³ una maÃ±ana: el dÃ­a cuarto.` },
                            { verse: 20, text: `Dijo Dios: Â«Bullan las aguas de seres vivos, y que las aves vuelen sobre la tierra, por el firmamento del cieloÂ».` },
                            { verse: 21, text: `CreÃ³ Dios los grandes monstruos marinos y todos los seres vivos que se mueven y que las aguas bullen segÃºn sus especies, y todas las aves aladas segÃºn sus especies. Y vio Dios que era bueno.` },
                            { verse: 22, text: `Los bendijo Dios, diciendo: Â«Sean fecundos y multiplÃ­quense, y llenen las aguas de los mares; y que las aves se multipliquen en la tierraÂ».` },
                            { verse: 23, text: `PasÃ³ una tarde, pasÃ³ una maÃ±ana: el dÃ­a quinto.` },
                            { verse: 24, text: `Dijo Dios: Â«Produzca la tierra seres vivos segÃºn sus especies: ganados, reptiles y bestias de la tierra segÃºn sus especiesÂ». Y asÃ­ fue.` },
                            { verse: 25, text: `Hizo Dios las bestias de la tierra segÃºn sus especies, los ganados segÃºn sus especies y todos los reptiles del campo segÃºn sus especies. Y vio Dios que era bueno.` },
                            { verse: 26, text: `Dijo Dios: Â«Hagamos al hombre a nuestra imagen ${ref('tzelem', 5)}, segÃºn nuestra semejanza; que domine los peces del mar, las aves del cielo, los ganados, y a toda la tierra, y a todos los reptiles que se arrastran por la tierraÂ».` },
                            { verse: 27, text: `Y creÃ³ Dios al hombre a su imagen, a imagen de Dios lo creÃ³; varÃ³n y mujer los creÃ³.` },
                            { verse: 28, text: `Y los bendijo Dios, y les dijo Dios: Â«Sean fecundos y multiplÃ­quense, llenen la tierra y somÃ©tanla; dominen los peces del mar, las aves del cielo y todos los animales que se mueven sobre la tierraÂ».` },
                            { verse: 29, text: `Dijo Dios: Â«Miren, les doy toda hierba que da semilla sobre la faz de toda la tierra, y todo Ã¡rbol que tiene fruto que da semilla; esto les servirÃ¡ de alimento.` },
                            { verse: 30, text: `Y a toda bestia de la tierra, a toda ave del cielo y a todo lo que se arrastra sobre la tierra, que tiene aliento de vida, toda hierba verde les doy por alimentoÂ». Y asÃ­ fue.` },
                            { verse: 31, text: `Vio Dios todo lo que habÃ­a hecho, y he aquÃ­ que era muy bueno. PasÃ³ una tarde, pasÃ³ una maÃ±ana: el dÃ­a sexto.` }
                        ],
                        // CapÃ­tulo 2 (con teologÃ­a)
                        [
                            { verse: 1, text: "AsÃ­ quedaron concluidos los cielos y la tierra con todo su ejÃ©rcito." },
                            { verse: 2, text: `Y concluyÃ³ Dios en el dÃ­a sÃ©ptimo la obra que habÃ­a hecho, y descansÃ³${ref('shabbat', 15)} el dÃ­a sÃ©ptimo de toda la obra que habÃ­a hecho.` },
                            { verse: 3, text: "Y bendijo Dios el dÃ­a sÃ©ptimo y lo santificÃ³, porque en Ã©l descansÃ³ de toda la obra que Dios habÃ­a creado y hecho." },
                            { verse: 4, text: "Estos son los orÃ­genes de los cielos y de la tierra cuando fueron creados, el dÃ­a en que el SeÃ±or Dios hizo la tierra y los cielos." },
                            { verse: 5, text: "No habÃ­a aÃºn en la tierra ningÃºn arbusto del campo, ni habÃ­a brotado aÃºn ninguna hierba del campo, porque el SeÃ±or Dios no habÃ­a hecho llover sobre la tierra, ni habÃ­a hombre para labrar el suelo," },
                            { verse: 6, text: "sino que subÃ­a de la tierra un vapor que regaba toda la faz del suelo." },
                            { verse: 7, text: `Entonces el SeÃ±or Dios formÃ³ al hombre del polvo del suelo${ref('adamah', 16)}, soplÃ³ en su nariz aliento de vida${ref('neshamah', 17)}, y fue el hombre un ser viviente.` },
                            { verse: 8, text: `Y el SeÃ±or Dios plantÃ³ un jardÃ­n en EdÃ©n${ref('ganeden', 18)}, al oriente, y puso allÃ­ al hombre que habÃ­a formado.` },
                            { verse: 9, text: "El SeÃ±or Dios hizo brotar del suelo toda clase de Ã¡rboles agradables a la vista y buenos para comer; y el Ã¡rbol de la vida en medio del jardÃ­n, y el Ã¡rbol del conocimiento del bien y del mal." },
                            { verse: 10, text: "Y salÃ­a de EdÃ©n un rÃ­o para regar el jardÃ­n, y de allÃ­ se repartÃ­a en cuatro brazos." },
                            { verse: 11, text: "El nombre del primero era PisÃ³n; este es el que rodea toda la tierra de Havila, donde hay oro." },
                            { verse: 12, text: "Y el oro de aquella tierra es bueno; hay allÃ­ bedelio y piedra de Ã³nice." },
                            { verse: 13, text: "El nombre del segundo rÃ­o es GihÃ³n; este es el que rodea toda la tierra de Cus." },
                            { verse: 14, text: "Y el nombre del tercer rÃ­o es Hidekel; este es el que va al oriente de Asiria. Y el cuarto rÃ­o es el Ã‰ufrates." },
                            { verse: 15, text: "TomÃ³, pues, el SeÃ±or Dios al hombre, y lo puso en el jardÃ­n de EdÃ©n, para que lo labrara y lo guardase." },
                            { verse: 16, text: "Y mandÃ³ el SeÃ±or Dios al hombre, diciendo: Â«De todo Ã¡rbol del jardÃ­n podrÃ¡s comer;" },
                            { verse: 17, text: "mas del Ã¡rbol del conocimiento del bien y del mal no comerÃ¡s; porque el dÃ­a que de Ã©l comieres, ciertamente morirÃ¡sÂ»." },
                            { verse: 18, text: `Y dijo el SeÃ±or Dios: Â«No es bueno que el hombre estÃ© solo; le harÃ© una ayuda idÃ³nea${ref('ezerkenegdo', 19)} para Ã©lÂ».` },
                            { verse: 19, text: "El SeÃ±or Dios formÃ³, pues, de la tierra toda bestia del campo y toda ave de los cielos, y las trajo a AdÃ¡n para que viese cÃ³mo las habÃ­a de llamar; y todo lo que AdÃ¡n llamÃ³ a los animales vivientes, ese es su nombre." },
                            { verse: 20, text: "Y puso AdÃ¡n nombre a toda bestia y ave de los cielos y a todo ganado del campo; mas para AdÃ¡n no se hallÃ³ ayuda idÃ³nea para Ã©l." },
                            { verse: 21, text: "Entonces el SeÃ±or Dios hizo caer un sueÃ±o profundo sobre AdÃ¡n, y mientras este dormÃ­a, tomÃ³ una de sus costillas y cerrÃ³ la carne en su lugar." },
                            { verse: 22, text: "Y de la costilla que el SeÃ±or Dios tomÃ³ del hombre, hizo una mujer, y la trajo al hombre." },
                            { verse: 23, text: "Dijo entonces AdÃ¡n: Â«Esto es ahora hueso de mis huesos y carne de mi carne; esta serÃ¡ llamada Varona, porque del varÃ³n fue tomadaÂ»." },
                            { verse: 24, text: "Por tanto, dejarÃ¡ el hombre a su padre y a su madre, y se unirÃ¡ a su mujer, y serÃ¡n una sola carne." },
                            { verse: 25, text: "Y estaban ambos desnudos, AdÃ¡n y su mujer, y no se avergonzaban." }
                        ],
                        ...Array.from({ length: 6 }, (_, i) => [{ verse: 1, text: `[Texto del capÃ­tulo ${i + 3} no cargado para optimizar el rendimiento.]` }]),
                        // CapÃ­tulo 9 (con teologÃ­a)
                        [
                            { verse: 1, text: "Bendijo Dios a NoÃ© y a sus hijos, y les dijo: Â«Sean fecundos, multiplÃ­quense y llenen la tierra." },
                            { verse: 2, text: "InfundirÃ© temor y espanto de ustedes en todos los animales de la tierra, en todas las aves del cielo, en todo lo que se mueve por el suelo y en todos los peces del mar; quedan en sus manos." },
                            { verse: 3, text: "Todo lo que se mueve y tiene vida les servirÃ¡ de alimento; se lo doy todo, como les di la hierba verde." },
                            { verse: 4, text: `Pero no comerÃ¡n carne con su vida, es decir, con su sangre ${ref('nefesh', 6)}.` },
                            { verse: 5, text: "PedirÃ© cuentas de la sangre de ustedes, que es su vida; se la pedirÃ© a cualquier animal. Y al hombre le pedirÃ© cuentas de la vida de su prÃ³jimo." },
                            { verse: 6, text: "Si alguien derrama la sangre de un hombre, otro hombre derramarÃ¡ su sangre; porque a imagen de Dios fue hecho el hombre." },
                            { verse: 7, text: "Ustedes, sean fecundos y multiplÃ­quense, pululen por la tierra y domÃ­nenlaÂ»." },
                            { verse: 8, text: "Dijo Dios a NoÃ© y a sus hijos con Ã©l:" },
                            { verse: 9, text: `Â«Miren, yo establezco mi alianza ${ref('berit', 7)} con ustedes y con su descendencia despuÃ©s de ustedes,` },
                            { verse: 10, text: "y con todo ser viviente que estÃ¡ con ustedes: aves, ganados y todas las fieras de la tierra que estÃ¡n con ustedes; con todos los que salieron del arca, con todo animal de la tierra." },
                            { verse: 11, text: "Establezco mi alianza con ustedes: nunca mÃ¡s serÃ¡ exterminada toda carne por las aguas del diluvio, ni habrÃ¡ mÃ¡s diluvio para destruir la tierraÂ»." },
                            { verse: 12, text: "Y dijo Dios: Â«Esta es la seÃ±al de la alianza que pongo entre yo y ustedes y todo ser viviente que estÃ¡ con ustedes, por generaciones perpetuas:" },
                            { verse: 13, text: `Pongo mi arco ${ref('qeshet', 8)} en las nubes, y servirÃ¡ de seÃ±al de la alianza entre yo y la tierra.` },
                            { verse: 14, text: "Cuando yo cubra de nubes la tierra y aparezca el arco en las nubes," },
                            { verse: 15, text: "me acordarÃ© de mi alianza, la que existe entre yo y ustedes y todo ser viviente de toda carne, y las aguas no volverÃ¡n a ser un diluvio para destruir toda carne." },
                            { verse: 16, text: "EstarÃ¡ el arco en las nubes, y yo lo verÃ© para acordarme de la alianza perpetua entre Dios y todo ser viviente de toda carne que hay sobre la tierraÂ»." },
                            { verse: 17, text: "Y dijo Dios a NoÃ©: Â«Esta es la seÃ±al de la alianza que he establecido entre yo y toda carne que hay sobre la tierraÂ»." },
                            { verse: 18, text: "Los hijos de NoÃ© que salieron del arca fueron Sem, Cam y Jafet. Cam es el padre de CanaÃ¡n." },
                            { verse: 19, text: "Estos tres fueron los hijos de NoÃ©, y a partir de ellos se poblÃ³ toda la tierra." },
                            { verse: 20, text: "NoÃ©, que era agricultor, comenzÃ³ a plantar una viÃ±a." },
                            { verse: 21, text: "BebiÃ³ del vino, se embriagÃ³ y quedÃ³ desnudo en medio de su tienda." },
                            { verse: 22, text: "Cam, padre de CanaÃ¡n, vio la desnudez de su padre y saliÃ³ a contÃ¡rselo a sus dos hermanos." },
                            { verse: 23, text: "Entonces Sem y Jafet tomaron un manto, se lo echaron sobre los hombros y, caminando hacia atrÃ¡s, cubrieron la desnudez de su padre. Como sus rostros estaban vueltos, no vieron la desnudez de su padre." },
                            { verse: 24, text: "Cuando NoÃ© despertÃ³ de su embriaguez y supo lo que le habÃ­a hecho su hijo menor," },
                            { verse: 25, text: "dijo: Â«Â¡Maldito sea CanaÃ¡n! SerÃ¡ el siervo mÃ¡s bajo de sus hermanosÂ»." },
                            { verse: 26, text: "Y aÃ±adiÃ³: Â«Â¡Bendito sea el SeÃ±or, el Dios de Sem! Â¡Que CanaÃ¡n sea su siervo!" },
                            { verse: 27, text: "Â¡Que Dios engrandezca a Jafet! Â¡Que habite en las tiendas de Sem, y que CanaÃ¡n sea su siervo!Â»." },
                            { verse: 28, text: "ViviÃ³ NoÃ© despuÃ©s del diluvio trescientos cincuenta aÃ±os." },
                            { verse: 29, text: "El total de los dÃ­as de NoÃ© fue de novecientos cincuenta aÃ±os, y muriÃ³." }
                        ],
                        // CapÃ­tulo 10 (con teologÃ­a)
                        [
                            { verse: 1, text: "Esta es la descendencia de los hijos de NoÃ©: Sem, Cam y Jafet, a quienes les nacieron hijos despuÃ©s del diluvio." },
                            { verse: 2, text: "Los hijos de Jafet: GÃ³mer, Magog, Maday, JavÃ¡n, Tubal, MÃ©sec y Tiras." },
                            { verse: 3, text: "Los hijos de GÃ³mer: Asquenaz, Rifat y Togarma." },
                            { verse: 4, text: "Los hijos de JavÃ¡n: Elisa, Tarsis, Quitim y Dodanim." },
                            { verse: 5, text: `A partir de estos se poblaron las islas de las naciones${ref('goyim', 9)}, en sus diversas tierras, cada cual segÃºn su lengua${ref('lashon', 10)}, por sus clanes y en sus naciones.` },
                            { verse: 6, text: "Los hijos de Cam: Cus, Misrayim, Put y CanaÃ¡n." },
                            { verse: 7, text: "Los hijos de Cus: Seba, JavilÃ¡, SabtÃ¡, Ragama y SabtecÃ¡. Los hijos de Ragama: Seba y DedÃ¡n." },
                            { verse: 8, text: `Cus engendrÃ³ a Nimrod${ref('nimrod', 11)}, que fue el primer hombre poderoso en la tierra.` },
                            { verse: 9, text: "Era un valiente cazador delante del SeÃ±or. Por eso se dice: Â«Como Nimrod, valiente cazador delante del SeÃ±orÂ»." },
                            { verse: 10, text: "El comienzo de su reino fue Babel, Erec, Acad y CalnÃ©, en la tierra de Sinar." },
                            { verse: 11, text: "De aquella tierra saliÃ³ para Asur y edificÃ³ NÃ­nive, Rejobot Ir, Cala," },
                            { verse: 12, text: "y Resen, entre NÃ­nive y Cala (aquella es la gran ciudad)." },
                            { verse: 13, text: "Misrayim engendrÃ³ a los ludeos, a los anameos, a los lehabitas, a los naftujitas," },
                            { verse: 14, text: "a los patruseos, a los caslujitas (de donde salieron los filisteos) y a los caftoritas." },
                            { verse: 15, text: "CanaÃ¡n engendrÃ³ a SidÃ³n, su primogÃ©nito, y a Het," },
                            { verse: 16, text: "y al jebuseo, al amorreo, al guirgaseo," },
                            { verse: 17, text: "al heveo, al araceo, al sineo," },
                            { verse: 18, text: "al arvadeo, al semareo y al jamateo. DespuÃ©s se dispersaron los clanes de los cananeos." },
                            { verse: 19, text: "El territorio de los cananeos se extendÃ­a desde SidÃ³n, en direcciÃ³n a Guerar, hasta Gaza; y en direcciÃ³n a Sodoma, Gomorra, AdmÃ¡ y Seboyim, hasta Lasa." },
                            { verse: 20, text: `Estos son los hijos de Cam, por sus clanes y lenguas${ref('lashon', 10)}, en sus tierras y naciones${ref('goyim', 9)}.` },
                            { verse: 21, text: "TambiÃ©n a Sem, padre de todos los hijos de HÃ©ber y hermano mayor de Jafet, le nacieron hijos." },
                            { verse: 22, text: "Los hijos de Sem: Elam, Asur, Arfaxad, Lud y Aram." },
                            { verse: 23, text: "Los hijos de Aram: Us, Hul, GuÃ©ter y Mas." },
                            { verse: 24, text: "Arfaxad engendrÃ³ a Sala, y Sala engendrÃ³ a HÃ©ber." },
                            { verse: 25, text: "A HÃ©ber le nacieron dos hijos: el nombre de uno fue PÃ©leg, porque en sus dÃ­as se dividiÃ³ la tierra; y el nombre de su hermano, JoctÃ¡n." },
                            { verse: 26, text: "JoctÃ¡n engendrÃ³ a Almodad, SÃ©lef, JasarmÃ¡vet, YÃ©raj," },
                            { verse: 27, text: "Hadoram, Uzal, DiclÃ¡," },
                            { verse: 28, text: "Obal, Abimael, Seba," },
                            { verse: 29, text: "Ofir, JavilÃ¡ y Jobab. Todos estos fueron hijos de JoctÃ¡n." },
                            { verse: 30, text: "El lugar donde habitaron se extendÃ­a desde MesÃ¡ en direcciÃ³n a Sefar, la montaÃ±a de oriente." },
                            { verse: 31, text: `Estos son los hijos de Sem, por sus clanes y lenguas${ref('lashon', 10)}, en sus tierras y naciones${ref('goyim', 9)}.` },
                            { verse: 32, text: `Estos son los clanes de los hijos de NoÃ©, segÃºn sus genealogÃ­as, en sus naciones${ref('goyim', 9)}. A partir de ellos se dispersaron las naciones por la tierra despuÃ©s del diluvio.` }
                        ],
                        // CapÃ­tulo 11 (con teologÃ­a)
                        [
                            { verse: 1, text: `TenÃ­a entonces toda la tierra una sola lengua${ref('saphah', 12)} y unas mismas palabras.` },
                            { verse: 2, text: "Y aconteciÃ³ que, cuando salieron de oriente, hallaron una llanura en la tierra de Sinar, y se establecieron allÃ­." },
                            { verse: 3, text: `Y se dijeron unos a otros: Â«Vamos, hagamos ladrillo${ref('lebenah', 13)} y cozÃ¡moslo con fuegoÂ». Y les sirviÃ³ el ladrillo en lugar de piedra, y el asfalto en lugar de mezcla.` },
                            { verse: 4, text: "Y dijeron: Â«Vamos, edifiquÃ©monos una ciudad y una torre, cuya cÃºspide llegue al cielo; y hagÃ¡monos un nombre, por si fuÃ©remos esparcidos sobre la faz de toda la tierraÂ»." },
                            { verse: 5, text: "Y descendiÃ³ el SeÃ±or para ver la ciudad y la torre que edificaban los hijos de los hombres." },
                            { verse: 6, text: "Y dijo el SeÃ±or: Â«He aquÃ­ el pueblo es uno, y todos estos tienen un solo lenguaje; y han comenzado la obra, y nada les harÃ¡ desistir ahora de lo que han pensado hacer." },
                            { verse: 7, text: "Ahora, pues, descendamos, y confundamos allÃ­ su lengua, para que ninguno entienda el habla de su compaÃ±eroÂ»." },
                            { verse: 8, text: "AsÃ­ los esparciÃ³ el SeÃ±or desde allÃ­ sobre la faz de toda la tierra, y dejaron de edificar la ciudad." },
                            { verse: 9, text: `Por esto fue llamado el nombre de ella Babel${ref('babel', 14)}, porque allÃ­ confundiÃ³ el SeÃ±or el lenguaje de toda la tierra, y desde allÃ­ los esparciÃ³ sobre la faz de toda la tierra.` },
                            { verse: 10, text: "Estas son las generaciones de Sem: Sem, de edad de cien aÃ±os, engendrÃ³ a Arfaxad, dos aÃ±os despuÃ©s del diluvio." },
                            { verse: 11, text: "Y viviÃ³ Sem, despuÃ©s que engendrÃ³ a Arfaxad, quinientos aÃ±os, y engendrÃ³ hijos e hijas." },
                            { verse: 12, text: "Arfaxad viviÃ³ treinta y cinco aÃ±os, y engendrÃ³ a Sala." },
                            { verse: 13, text: "Y viviÃ³ Arfaxad, despuÃ©s que engendrÃ³ a Sala, cuatrocientos tres aÃ±os, y engendrÃ³ hijos e hijas." },
                            { verse: 14, text: "Sala viviÃ³ treinta aÃ±os, y engendrÃ³ a HÃ©ber." },
                            { verse: 15, text: "Y viviÃ³ Sala, despuÃ©s que engendrÃ³ a HÃ©ber, cuatrocientos tres aÃ±os, y engendrÃ³ hijos e hijas." },
                            { verse: 16, text: "HÃ©ber viviÃ³ treinta y cuatro aÃ±os, y engendrÃ³ a PÃ©leg." },
                            { verse: 17, text: "Y viviÃ³ HÃ©ber, despuÃ©s que engendrÃ³ a PÃ©leg, cuatrocientos treinta aÃ±os, y engendrÃ³ hijos e hijas." },
                            { verse: 18, text: "PÃ©leg viviÃ³ treinta aÃ±os, y engendrÃ³ a Reu." },
                            { verse: 19, text: "Y viviÃ³ PÃ©leg, despuÃ©s que engendrÃ³ a Reu, doscientos nueve aÃ±os, y engendrÃ³ hijos e hijas." },
                            { verse: 20, text: "Reu viviÃ³ treinta y dos aÃ±os, y engendrÃ³ a Serug." },
                            { verse: 21, text: "Y viviÃ³ Reu, despuÃ©s que engendrÃ³ a Serug, doscientos siete aÃ±os, y engendrÃ³ hijos e hijas." },
                            { verse: 22, text: "Serug viviÃ³ treinta aÃ±os, y engendrÃ³ a Nacor." },
                            { verse: 23, text: "Y viviÃ³ Serug, despuÃ©s que engendrÃ³ a Nacor, doscientos aÃ±os, y engendrÃ³ hijos e hijas." },
                            { verse: 24, text: "Nacor viviÃ³ veintinueve aÃ±os, y engendrÃ³ a TarÃ©." },
                            { verse: 25, text: "Y viviÃ³ Nacor, despuÃ©s que engendrÃ³ a TarÃ©, ciento diecinueve aÃ±os, y engendrÃ³ hijos e hijas." },
                            { verse: 26, text: "TarÃ© viviÃ³ setenta aÃ±os, y engendrÃ³ a Abram, a Nacor y a HarÃ¡n." },
                            { verse: 27, text: "Estas son las generaciones de TarÃ©: TarÃ© engendrÃ³ a Abram, a Nacor y a HarÃ¡n; y HarÃ¡n engendrÃ³ a Lot." },
                            { verse: 28, text: "Y muriÃ³ HarÃ¡n antes que su padre TarÃ© en la tierra de su nacimiento, en Ur de los caldeos." },
                            { verse: 29, text: "Y tomaron Abram y Nacor para sÃ­ mujeres; el nombre de la mujer de Abram era Sarai, y el nombre de la mujer de Nacor, Milca, hija de HarÃ¡n, padre de Milca y de Isca." },
                            { verse: 30, text: "Mas Sarai era estÃ©ril, y no tenÃ­a hijo." },
                            { verse: 31, text: "Y tomÃ³ TarÃ© a Abram su hijo, y a Lot hijo de HarÃ¡n, hijo de su hijo, y a Sarai su nuera, mujer de Abram su hijo, y saliÃ³ con ellos de Ur de los caldeos, para ir a la tierra de CanaÃ¡n; y vinieron hasta HarÃ¡n, y moraron allÃ­." },
                            { verse: 32, text: "Y fueron los dÃ­as de TarÃ© doscientos cinco aÃ±os; y muriÃ³ TarÃ© en HarÃ¡n." }
                        ],
                        // Placeholder for remaining chapters
                        ...Array.from({ length: 39 }, (_, i) => [{ verse: 1, text: `[Texto del capÃ­tulo ${i + 12} no cargado para optimizar el rendimiento.]` }])
                    ]
                },
                { name: "Ã‰xodo", testament: "OT", chapters: placeholderChapter(40) },
                { name: "LevÃ­tico", testament: "OT", chapters: placeholderChapter(27) },
                { name: "NÃºmeros", testament: "OT", chapters: placeholderChapter(36) },
                { name: "Deuteronomio", testament: "OT", chapters: placeholderChapter(34) },
                { name: "JosuÃ©", testament: "OT", chapters: placeholderChapter(24) },
                { name: "Jueces", testament: "OT", chapters: placeholderChapter(21) },
                { name: "Rut", testament: "OT", chapters: placeholderChapter(4) },
                { name: "1 Samuel", testament: "OT", chapters: placeholderChapter(31) },
                { name: "2 Samuel", testament: "OT", chapters: placeholderChapter(24) },
                { name: "1 Reyes", testament: "OT", chapters: placeholderChapter(22) },
                { name: "2 Reyes", testament: "OT", chapters: placeholderChapter(25) },
                { name: "1 CrÃ³nicas", testament: "OT", chapters: placeholderChapter(29) },
                { name: "2 CrÃ³nicas", testament: "OT", chapters: placeholderChapter(36) },
                { name: "Esdras", testament: "OT", chapters: placeholderChapter(10) },
                { name: "NehemÃ­as", testament: "OT", chapters: placeholderChapter(13) },
                { name: "TobÃ­as", testament: "OT", chapters: placeholderChapter(14) },
                { name: "Judit", testament: "OT", chapters: placeholderChapter(16) },
                { name: "Ester", testament: "OT", chapters: placeholderChapter(10) },
                { name: "1 Macabeos", testament: "OT", chapters: placeholderChapter(16) },
                { name: "2 Macabeos", testament: "OT", chapters: placeholderChapter(15) },
                { name: "Job", testament: "OT", chapters: placeholderChapter(42) },
                { name: "Salmos", testament: "OT", chapters: placeholderChapter(150) },
                { name: "Proverbios", testament: "OT", chapters: placeholderChapter(31) },
                { name: "EclesiastÃ©s", testament: "OT", chapters: placeholderChapter(12) },
                { name: "Cantar de los Cantares", testament: "OT", chapters: placeholderChapter(8) },
                { name: "SabidurÃ­a", testament: "OT", chapters: placeholderChapter(19) },
                { name: "EclesiÃ¡stico (SirÃ¡cida)", testament: "OT", chapters: placeholderChapter(51) },
                { name: "IsaÃ­as", testament: "OT", chapters: placeholderChapter(66) },
                { name: "JeremÃ­as", testament: "OT", chapters: placeholderChapter(52) },
                { name: "Lamentaciones", testament: "OT", chapters: placeholderChapter(5) },
                { name: "Baruc", testament: "OT", chapters: placeholderChapter(6) },
                { name: "Ezequiel", testament: "OT", chapters: placeholderChapter(48) },
                { name: "Daniel", testament: "OT", chapters: placeholderChapter(14) },
                { name: "Oseas", testament: "OT", chapters: placeholderChapter(14) },
                { name: "Joel", testament: "OT", chapters: placeholderChapter(4) },
                { name: "AmÃ³s", testament: "OT", chapters: placeholderChapter(9) },
                { name: "AbdÃ­as", testament: "OT", chapters: placeholderChapter(1) },
                { name: "JonÃ¡s", testament: "OT", chapters: placeholderChapter(4) },
                { name: "Miqueas", testament: "OT", chapters: placeholderChapter(7) },
                { name: "NahÃºm", testament: "OT", chapters: placeholderChapter(3) },
                { name: "Habacuc", testament: "OT", chapters: placeholderChapter(3) },
                { name: "SofonÃ­as", testament: "OT", chapters: placeholderChapter(3) },
                { name: "Ageo", testament: "OT", chapters: placeholderChapter(2) },
                { name: "ZacarÃ­as", testament: "OT", chapters: placeholderChapter(14) },
                { name: "MalaquÃ­as", testament: "OT", chapters: placeholderChapter(3) },
                // New Testament - 27 Books
                { name: "Mateo", testament: "NT", chapters: placeholderChapter(28) },
                { name: "Marcos", testament: "NT", chapters: placeholderChapter(16) },
                { name: "Lucas", testament: "NT", chapters: placeholderChapter(24) },
                { name: "Juan", testament: "NT", chapters: placeholderChapter(21) },
                { name: "Hechos de los ApÃ³stoles", testament: "NT", chapters: placeholderChapter(28) },
                { name: "Romanos", testament: "NT", chapters: placeholderChapter(16) },
                { name: "1 Corintios", testament: "NT", chapters: placeholderChapter(16) },
                { name: "2 Corintios", testament: "NT", chapters: placeholderChapter(13) },
                { name: "GÃ¡latas", testament: "NT", chapters: placeholderChapter(6) },
                { name: "Efesios", testament: "NT", chapters: placeholderChapter(6) },
                { name: "Filipenses", testament: "NT", chapters: placeholderChapter(4) },
                { name: "Colosenses", testament: "NT", chapters: placeholderChapter(4) },
                { name: "1 Tesalonicenses", testament: "NT", chapters: placeholderChapter(5) },
                { name: "2 Tesalonicenses", testament: "NT", chapters: placeholderChapter(3) },
                { name: "1 Timoteo", testament: "NT", chapters: placeholderChapter(6) },
                { name: "2 Timoteo", testament: "NT", chapters: placeholderChapter(4) },
                { name: "Tito", testament: "NT", chapters: placeholderChapter(3) },
                { name: "FilemÃ³n", testament: "NT", chapters: placeholderChapter(1) },
                { name: "Hebreos", testament: "NT", chapters: placeholderChapter(13) },
                { name: "Santiago", testament: "NT", chapters: placeholderChapter(5) },
                { name: "1 Pedro", testament: "NT", chapters: placeholderChapter(5) },
                { name: "2 Pedro", testament: "NT", chapters: placeholderChapter(3) },
                { name: "1 Juan", testament: "NT", chapters: placeholderChapter(5) },
                { name: "2 Juan", testament: "NT", chapters: placeholderChapter(1) },
                { name: "3 Juan", testament: "NT", chapters: placeholderChapter(1) },
                { name: "Judas", testament: "NT", chapters: placeholderChapter(1) },
                { name: "Apocalipsis", testament: "NT", chapters: placeholderChapter(22) },
            ];

            // --- COMPLETE LITURGICAL DATA GENERATOR ---
            function getLiturgyForDate(date) {
                const year = date.getFullYear();
                if (year !== 2025) return null;

                const toYYYYMMDD = d => `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
                const dateString = toYYYYMMDD(date);
                
                const easter = new Date(2025, 3, 20);
                const firstSundayOfAdvent = new Date(2025, 10, 30);

                let season = 'Ordinary Time';
                let seasonColor = '#16a34a'; // green-600
                if (date >= firstSundayOfAdvent && date < new Date(2025, 11, 25)) { season = 'Advent'; seasonColor = '#6d28d9'; } // violet-700
                else if ((date >= new Date(2025, 11, 25)) || (date < new Date(2025, 0, 12))) { season = 'Christmas'; seasonColor = '#ca8a04'; } // yellow-600
                else if (date >= new Date(2025, 2, 5) && date < easter) { season = 'Lent'; seasonColor = '#9333ea'; } // purple-600
                else if (date >= easter && date <= addDays(easter, 50)) { season = 'Easter'; seasonColor = '#f59e0b'; } // amber-500

                let liturgy = {
                    title: '', cycle: '', omitGloria: false, omitCredo: false, omitAlleluia: false, seasonColor: seasonColor,
                    prayers: { collect: '', offerings: '', postCommunion: '', preface: ''},
                    readings: { firstReading: null, psalm: null, secondReading: null, alleluiaVerse: null, gospelAcclamationVerse: null, gospel: null }
                };
                
                const placeholderReadings = {
                    firstReading: { ref: 'Lectura I', text: 'Texto de la primera lectura no disponible.' },
                    psalm: { ref: 'Salmo Responsorial', response: 'Respuesta del salmo.', stanzas: ['Estrofa del salmo no disponible.'] },
                    secondReading: { ref: 'Lectura II', text: 'Texto de la segunda lectura no disponible.' },
                    alleluiaVerse: 'VersÃ­culo del Aleluya no disponible.',
                    gospel: { ref: 'Evangelio', text: 'Texto del Evangelio no disponible.' }
                };

                // --- SEASONAL FLAGS ---
                if (season === 'Advent' || season === 'Lent') { liturgy.omitGloria = true; }
                if (season === 'Lent') { liturgy.omitAlleluia = true; }

                // --- SOLEMNITIES AND FEASTS (OVERRIDE SUNDAY LOGIC) ---
                const solemnities = {
                    '2025-01-01': { title: 'Santa MarÃ­a, Madre de Dios', seasonColor: '#e5e7eb' },
                    '2025-01-05': { title: 'EpifanÃ­a del SeÃ±or', seasonColor: '#e5e7eb' }, // Sunday
                    '2025-01-12': { title: 'Bautismo del SeÃ±or', seasonColor: '#e5e7eb' }, // Sunday
                    '2025-03-05': { title: 'MiÃ©rcoles de Ceniza', seasonColor: '#9333ea' },
                    '2025-04-13': { title: 'Domingo de Ramos', seasonColor: '#dc2626' }, // Sunday
                    '2025-04-17': { title: 'Jueves Santo (Misa de la Cena del SeÃ±or)', seasonColor: '#e5e7eb' },
                    '2025-04-18': { title: 'Viernes Santo (PasiÃ³n del SeÃ±or)', seasonColor: '#dc2626' },
                    '2025-04-19': { title: 'SÃ¡bado Santo (Vigilia Pascual)', seasonColor: '#f59e0b' },
                    '2025-04-20': { title: 'Domingo de Pascua', seasonColor: '#f59e0b' }, // Sunday
                    '2025-06-01': { title: 'AscensiÃ³n del SeÃ±or', seasonColor: '#e5e7eb' }, // Sunday
                    '2025-06-08': { title: 'Domingo de PentecostÃ©s', seasonColor: '#dc2626' }, // Sunday
                    '2025-06-15': { title: 'SantÃ­sima Trinidad', seasonColor: '#e5e7eb' }, // Sunday
                    '2025-06-22': { title: 'SantÃ­simo Cuerpo y Sangre de Cristo', seasonColor: '#e5e7eb' }, // Sunday
                    '2025-08-15': { title: 'AsunciÃ³n de la Virgen MarÃ­a', seasonColor: '#e5e7eb' },
                    '2025-11-01': { title: 'Todos los Santos', seasonColor: '#e5e7eb' },
                    '2025-11-23': { title: 'Jesucristo, Rey del Universo', seasonColor: '#e5e7eb' }, // Sunday
                    '2025-12-08': { title: 'Inmaculada ConcepciÃ³n de la Virgen MarÃ­a', seasonColor: '#e5e7eb' },
                    '2025-12-25': { title: 'Natividad del SeÃ±or (Navidad)', seasonColor: '#f59e0b' },
                };

                if (solemnities[dateString]) {
                    liturgy.title = solemnities[dateString].title;
                    liturgy.seasonColor = solemnities[dateString].seasonColor;
                    liturgy.cycle = 'Solemnidad';
                    liturgy.readings = placeholderReadings; 
                }

                // --- ORDINARY SUNDAYS (CYCLE C) ---
                if (date.getDay() === 0 && !solemnities[dateString]) {
                     if (dateString === '2025-07-27') {
                        liturgy.title = 'XVII Domingo del Tiempo Ordinario';
                        liturgy.cycle = 'Ciclo C';
                        liturgy.readings = placeholderReadings;
                    } else if (dateString === '2025-08-03') {
                        liturgy.title = 'XVIII Domingo del Tiempo Ordinario';
                        liturgy.cycle = 'Ciclo C';
                        liturgy.readings = placeholderReadings;
                    } else if (dateString === '2025-08-10') {
                        liturgy.title = 'XIX Domingo del Tiempo Ordinario';
                        liturgy.cycle = 'Ciclo C';
                        liturgy.prayers = {
                            collect: 'Dios todopoderoso y eterno, a quien podemos llamar Padre, aumenta en nuestros corazones el espÃ­ritu de hijos adoptivos, para que merezcamos entrar un dÃ­a en la herencia prometida. Por nuestro SeÃ±or Jesucristo.',
                            offerings: 'SÃ© propicio, SeÃ±or, a tu pueblo y acepta con bondad estas ofrendas, para que, con la ayuda de tu piedad, a cada uno le aproveche para su salvaciÃ³n lo que ofrece en honor de tu nombre. Por Jesucristo, nuestro SeÃ±or.',
                            postCommunion: 'Que la comuniÃ³n en tus sacramentos nos salve, SeÃ±or, y nos afiance en la luz de tu verdad. Por Jesucristo, nuestro SeÃ±or.',
                            preface: 'En verdad es justo y necesario, es nuestro deber y salvaciÃ³n darte gracias siempre y en todo lugar, SeÃ±or, Padre santo, Dios todopoderoso y eterno. Pues, aunque no necesitas nuestra alabanza, es don tuyo que seamos agradecidos; y aunque nuestras bendiciones no aumentan tu gloria, nos aprovechan para nuestra salvaciÃ³n. Por Cristo, SeÃ±or nuestro. Por eso, unidos a los Ã¡ngeles, te aclamamos llenos de alegrÃ­a:'
                        };
                        liturgy.readings = {
                            firstReading: { ref: 'SabidurÃ­a 18, 6-9', text: `La noche de la liberaciÃ³n fue anunciada de antemano a nuestros padres, para que tuvieran Ã¡nimo al conocer con certeza la promesa de la que se fiaban. Tu pueblo esperaba, a la vez, la salvaciÃ³n de los justos y la perdiciÃ³n de los enemigos. Porque con la misma acciÃ³n que castigaste a los adversarios, nos glorificaste a nosotros, llamÃ¡ndonos a ti. Los santos hijos de los buenos ofrecÃ­an sacrificios a escondidas y establecieron de comÃºn acuerdo esta ley divina: que los santos compartirÃ­an por igual los mismos bienes y peligros; y entonaron los himnos de los padres.` },
                            psalm: { ref: 'Salmo 32', response: 'Dichoso el pueblo que el SeÃ±or se escogiÃ³ como heredad.', stanzas: [ `Aclamad, justos, al SeÃ±or,<br>que merece la alabanza de los buenos.<br>Dichosa la naciÃ³n cuyo Dios es el SeÃ±or,<br>el pueblo que Ã©l se escogiÃ³ como heredad.`, `El SeÃ±or mira desde el cielo,<br>se fija en todos los hombres.<br>Desde su morada observa<br>a todos los habitantes de la tierra.`, `Los ojos del SeÃ±or estÃ¡n puestos en quien lo teme,<br>en los que esperan en su misericordia,<br>para librar sus vidas de la muerte<br>y reanimarlos en tiempo de hambre.`, `Nosotros aguardamos al SeÃ±or:<br>Ã©l es nuestro auxilio y escudo;<br>que tu misericordia, SeÃ±or, venga sobre nosotros,<br>como lo esperamos de ti.` ] },
                            secondReading: { ref: 'Hebreos 11, 1-2. 8-19', text: `Hermanos: La fe es garantÃ­a${ref('hypostasis', 1)} de lo que se espera, la prueba${ref('elenchos', 2)} de las realidades que no se ven. Por ella fueron alabados nuestros mayores. Por la fe, AbrahÃ¡n, al ser llamado por Dios, obedeciÃ³ y saliÃ³ para el lugar que habÃ­a de recibir en herencia, y saliÃ³ sin saber a dÃ³nde iba. Por la fe, se estableciÃ³ en la tierra prometida como en tierra extraÃ±a, viviendo en tiendas, y lo mismo Isaac y Jacob, herederos de la misma promesa${ref('epangelia', 3)}, pues esperaba la ciudad de sÃ³lidos cimientos, cuyo arquitecto y constructor es Dios. Por la fe, tambiÃ©n Sara, siendo estÃ©ril, obtuvo vigor para concebir, a pesar de su edad avanzada, porque creyÃ³ que era fiel el que se lo prometÃ­a. Y asÃ­, de un solo hombre, y ya marcado por la muerte, nacieron hijos, numerosos como las estrellas del cielo e incontables como la arena de las playas. Con fe murieron todos estos, sin haber recibido las promesas; las vieron y las saludaron de lejos, confesando que eran extraÃ±os y peregrinos en la terra. Los que asÃ­ hablan, dan a entender que buscan una patria; pues si hubieran pensado en la que habÃ­an abandonado, tenÃ­an ocasiÃ³n de volver. Pero ellos ansiaban una patria mejor, la celestial. Por eso Dios no se avergÃ¼enza de llamarse su Dios, pues les tenÃ­a preparada una ciudad. Por la fe, AbrahÃ¡n, puesto a prueba, ofreciÃ³ a Isaac; y el que habÃ­a recibido las promesas, ofrecÃ­a a su unigÃ©nito, a quien se le habÃ­a dicho: Â«La descendencia que lleve tu nombre serÃ¡ la de IsaacÂ». Pero AbrahÃ¡n pensaba que Dios tiene poder hasta para resucitar de entre los muertos, de donde en cierto sentido lo recobrÃ³.` },
                            alleluiaVerse: 'Estad en vela y preparados, porque a la hora que menos pensÃ©is viene el Hijo del hombre. (cf. Mt 24, 42a. 44)',
                            gospel: { ref: 'Lucas 12, 32-48', text: `En aquel tiempo, dijo JesÃºs a sus discÃ­pulos: Â«No temas, pequeÃ±o rebaÃ±o${ref('poimnion', 4)}, porque vuestro Padre ha tenido a bien daros el reino. Vended vuestros bienes y dad limosna. Haceos bolsas que no se estropeen, un tesoro inagotable en el cielo, adonde no se acercan los ladrones ni roe la polilla. Porque donde estÃ¡ vuestro tesoro, allÃ­ estarÃ¡ tambiÃ©n vuestro corazÃ³n${ref('kardia', 5)}. Tened ceÃ±ida la cintura y encendidas las lÃ¡mparas. Vosotros estad como los hombres que aguardan a que su seÃ±or vuelva de la boda, para abrirle apenas venga y llame. Bienaventurados aquellos criados a quienes el seÃ±or, al llegar, los encuentre en vela${ref('gregoreÅ', 6)}; en verdad os digo que se ceÃ±irÃ¡, los harÃ¡ sentar a la mesa y, acercÃ¡ndose, les irÃ¡ sirviendo. Y, si llega a la segunda vigilia o a la tercera y los encuentra asÃ­, Â¡bienaventurados ellos! Comprended que si supiera el dueÃ±o de casa a quÃ© hora viene el ladrÃ³n, no le dejarÃ­a abrir un boquete en su casa. Lo mismo vosotros, estad preparados, porque a la hora que menos pensÃ©is viene el Hijo del hombreÂ». Pedro le dijo: Â«SeÃ±or, Â¿dices esta parÃ¡bola por nosotros o por todos?Â». Y el SeÃ±or dijo: Â«Â¿QuiÃ©n es el administrador fiel y prudente a quien el seÃ±or pondrÃ¡ al frente de su servidumbre para que reparta la raciÃ³n de alimento a sus horas? Bienaventurado aquel siervo${ref('doulos', 7)} a quien su seÃ±or, al llegar, lo encuentre portÃ¡ndose asÃ­. En verdad os digo que lo pondrÃ¡ al frente de todos sus bienes. Pero si aquel siervo dijere para sus adentros: â€œMi seÃ±or tarda en llegarâ€, y empieza a pegarles a los criados y a las criadas, a comer y beber y emborracharse, vendrÃ¡ el seÃ±or de ese siervo el dÃ­a que menos lo espera y a la hora que no sabe y lo castigarÃ¡ con rigor, y le asignarÃ¡ la suerte de los infieles. El siervo que, conociendo la voluntad de su seÃ±or, no se prepara ni obra de acuerdo con su voluntad, recibirÃ¡ muchos azotes; pero el que, sin conocerla, ha hecho algo digno de azotes, recibirÃ¡ menos. A quien mucho se le dio, mucho se le reclamarÃ¡; a quien mucho se le confiÃ³, mÃ¡s aÃºn se le pedirÃ¡Â».` }
                        };
                    } else {
                        // Placeholder for other Sundays
                        liturgy.title = `Domingo de ${season}`;
                        liturgy.cycle = 'Ciclo C';
                        liturgy.readings = placeholderReadings;
                    }
                }
                
                if (!liturgy.title) return null; // If no title was set, it's not a liturgical day we're tracking.

                return liturgy;
            }
            
            // --- DOM ELEMENTS & STATE ---
            const splashScreen = document.getElementById('splash-screen');
            const mainContent = document.getElementById('main-content');
            const fullLiturgyView = document.getElementById('full-liturgy-view');
            const backToCalendarBtn = document.getElementById('back-to-calendar-btn');
            const printBtn = document.getElementById('print-btn');
            const downloadDocxBtn = document.getElementById('download-docx-btn');
            const hamburgerBtn = document.getElementById('hamburger-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const closeMenuBtn = document.getElementById('close-menu-btn');
            const mobileNavLinks = document.getElementById('mobile-nav-links');
            const mainNavButtons = { 
                home: document.getElementById('btn-home'),
                liturgy: document.getElementById('btn-liturgy'), 
                bible: document.getElementById('btn-bible'),
                glossary: document.getElementById('btn-glossary'), 
                lectionary: document.getElementById('btn-lectionary')
            };
            const views = { 
                home: document.getElementById('home-view'),
                liturgy: document.getElementById('liturgy-view'), 
                bible: document.getElementById('bible-view'),
                glossary: document.getElementById('glossary-view'), 
                lectionary: document.getElementById('lectionary-view')
            };
            
            const fullLiturgyUI = { title: document.getElementById('full-liturgy-title'), subtitle: document.getElementById('full-liturgy-subtitle'), content: document.getElementById('full-liturgy-content') };
            const uploadLogoBtn = document.getElementById('btn-upload-logo');
            const logoUploader = document.getElementById('logo-uploader');
            const logoImage = document.getElementById('logo-image');
            const theologyPopup = document.getElementById('theology-popup');
            const theologyPopupOverlay = document.getElementById('theology-popup-overlay');
            const theologyPopupContent = document.getElementById('popup-content-theology');
            const theologyPopupClose = document.getElementById('popup-close');
            const cardsContainer = document.getElementById('liturgical-cards-container');

            // --- BIBLE VIEW ELEMENTS ---
            const bibleHeader = {
                backBtn: document.getElementById('bible-back-btn'),
                title: document.getElementById('bible-view-title')
            };
            const bibleViews = {
                testament: document.getElementById('testament-selector-view'),
                book: document.getElementById('book-selector-view'),
                chapter: document.getElementById('chapter-selector-view'),
                content: document.getElementById('chapter-content-view')
            };
            const bibleSelectors = {
                selectOT: document.getElementById('select-ot'),
                selectNT: document.getElementById('select-nt')
            };
            let bibleNavState = {
                level: 'root', // root, testament, book, chapter
                testament: null,
                bookIndex: null,
                chapterIndex: null
            };

            // --- FUNCTIONS ---
            function switchView(viewName) {
                Object.values(views).forEach(v => v.classList.add('hidden'));
                Object.values(mainNavButtons).forEach(b => b.classList.remove('active-nav'));
                if (views[viewName]) {
                    views[viewName].classList.remove('hidden');
                }
                if (mainNavButtons[viewName]) {
                    mainNavButtons[viewName].classList.add('active-nav');
                }
            }
            
            function renderLiturgicalCards() {
                cardsContainer.innerHTML = '';
                const startDate = new Date(2025, 0, 1);
                const endDate = new Date(2025, 11, 31);

                for (let d = startDate; d <= endDate; d.setDate(d.getDate() + 1)) {
                    const liturgyData = getLiturgyForDate(new Date(d));
                    if (liturgyData) {
                        const card = document.createElement('div');
                        card.className = 'liturgical-card flex items-center p-4 rounded-lg shadow-md cursor-pointer';
                        card.style.borderColor = liturgyData.seasonColor;
                        card.dataset.date = d.toISOString().split('T')[0];
                        
                        card.innerHTML = `
                            <div class="flex-shrink-0 w-20 text-center">
                                <p class="text-gray-500 text-sm">${d.toLocaleDateString('es-ES', { weekday: 'short' }).replace('.', '')}</p>
                                <p class="text-2xl font-bold text-gray-800">${d.getDate()}</p>
                                <p class="text-gray-500 text-sm">${d.toLocaleDateString('es-ES', { month: 'short' }).replace('.', '')}</p>
                            </div>
                            <div class="flex-grow pl-4">
                                <h3 class="font-bold text-lg text-gray-900">${liturgyData.title}</h3>
                                <p class="text-sm text-gray-600">${liturgyData.cycle}</p>
                            </div>
                            <div class="flex-shrink-0">
                               <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </div>
                        `;
                        cardsContainer.appendChild(card);
                    }
                }
            }

            function showFullLiturgy(date) {
                renderFullLiturgyView(date); 
                mainContent.classList.add('hidden');
                fullLiturgyView.classList.remove('hidden');
                fullLiturgyView.scrollTop = 0;
            }

            function renderFullLiturgyView(date) {
                const liturgy = getLiturgyForDate(date);
                if (liturgy && liturgy.readings && liturgy.readings.firstReading.text !== 'Texto de la primera lectura no disponible.') {
                    fullLiturgyUI.title.textContent = liturgy.title;
                    const formattedDate = date.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    fullLiturgyUI.subtitle.textContent = `${formattedDate} | ${liturgy.cycle}`;
                    
                    const templates = {
                        initialGreeting: `<h3>Saludo Inicial</h3><p class="liturgy-text">En el nombre del Padre, y del Hijo, y del EspÃ­ritu Santo.<br><strong>AmÃ©n.</strong><br>La gracia de nuestro SeÃ±or Jesucristo, el amor del Padre y la comuniÃ³n del EspÃ­ritu Santo estÃ© con todos ustedes.<br><strong>Y con tu espÃ­ritu.</strong></p>`,
                        penitentialAct: `<h3>Acto Penitencial (Libro de OraciÃ³n ComÃºn ACNA)</h3><p class="liturgy-text">Amados en el SeÃ±or, acerquÃ©monos con un corazÃ³n penitente y obediente a la Palabra de Dios, confesando nuestros pecados para que podamos recibir el perdÃ³n por su infinita bondad y misericordia.<br><em>Se guarda un momento de silencio.</em><br><strong>MisericordiosÃ­simo Dios, confesamos que hemos pecado contra ti en pensamiento, palabra y obra, por lo que hemos hecho y por lo que hemos dejado de hacer. No te hemos amado con todo nuestro corazÃ³n; no hemos amado a nuestro prÃ³jimo como a nosotros mismos. Lo sentimos de veras y nos arrepentimos humildemente. Por tu Hijo Jesucristo, ten misericordia de nosotros y perdÃ³nanos, para que nos deleitemos en tu voluntad y andemos en tus caminos, para la gloria de tu Nombre. AmÃ©n.</strong><br>Dios todopoderoso tenga misericordia de nosotros, perdone nuestros pecados y nos lleve a la vida eterna.<br><strong>AmÃ©n.</strong></p>`,
                        gloria: `<h3>Gloria</h3><p class="liturgy-text"><strong>Gloria a Dios en el cielo, y en la tierra paz a los hombres que ama el SeÃ±or. Por tu inmensa gloria te alabamos, te bendecimos, te adoramos, te glorificamos, te damos gracias, SeÃ±or Dios, Rey celestial, Dios Padre todopoderoso. SeÃ±or, Hijo Ãºnico, Jesucristo. SeÃ±or Dios, Cordero de Dios, Hijo del Padre; tÃº que quitas el pecado del mundo, ten piedad de nosotros; tÃº que quitas el pecado del mundo, atiende nuestra sÃºplica; tÃº que estÃ¡s sentado a la derecha del Padre, ten piedad de nosotros. Porque sÃ³lo tÃº eres Santo, sÃ³lo tÃº SeÃ±or, sÃ³lo tÃº AltÃ­simo, Jesucristo, con el EspÃ­ritu Santo en la gloria de Dios Padre. AmÃ©n.</strong></p>`,
                        alleluia: (verse) => `<h3>Aleluya</h3><p class="liturgy-text"><strong>Aleluya, aleluya.</strong><br>${verse}<br><strong>Aleluya.</strong></p>`,
                        gospelAcclamation: (verse) => `<h3>AclamaciÃ³n antes del Evangelio</h3><p class="liturgy-text">${verse}</p>`,
                        gospel: (gospelData) => `<h3>Evangelio: ${gospelData.ref}</h3><p class="liturgy-text">El SeÃ±or estÃ© con ustedes.<br><strong>Y con tu espÃ­ritu.</strong><br>Lectura del santo Evangelio segÃºn san ${gospelData.ref.split(' ')[0]}.<br><strong>Gloria a ti, SeÃ±or.</strong></p><p class="liturgy-text">${gospelData.text}</p><p class="liturgy-text">Palabra del SeÃ±or.<br><strong>Gloria a ti, SeÃ±or JesÃºs.</strong></p>`,
                        credo: `<h3>ProfesiÃ³n de Fe - Credo Niceno</h3><p class="liturgy-text"><strong>Creo en un solo Dios, Padre todopoderoso, Creador del cielo y de la tierra, de todo lo visible y lo invisible. Creo en un solo SeÃ±or, Jesucristo, Hijo Ãºnico de Dios, nacido del Padre antes de todos los siglos: Dios de Dios, Luz de Luz, Dios verdadero de Dios verdadero, engendrado, no creado, de la misma naturaleza del Padre, por quien todo fue hecho; que por nosotros, los hombres, y por nuestra salvaciÃ³n bajÃ³ del cielo, y por obra del EspÃ­ritu Santo se encarnÃ³ de MarÃ­a, la Virgen, y se hizo hombre; y por nuestra causa fue crucificado en tiempos de Poncio Pilato; padeciÃ³ y fue sepultado, y resucitÃ³ al tercer dÃ­a, segÃºn las Escrituras, y subiÃ³ al cielo, y estÃ¡ sentado a la derecha del Padre; y de nuevo vendrÃ¡ con gloria para juzgar a vivos y muertos, y su reino no tendrÃ¡ fin. Creo en el EspÃ­ritu Santo, SeÃ±or y dador de vida, que procede del Padre y del Hijo, que con el Padre y del Hijo recibe una misma adoraciÃ³n y gloria, y que hablÃ³ por los profetas. Creo en la Iglesia, que es una, santa, catÃ³lica Ğ¸ apostÃ³lica. Confieso que hay un solo bautismo para el perdÃ³n de los pecados. Espero la resurrecciÃ³n de los muertos y la vida del mundo futuro. AmÃ©n.</strong></p>`,
                        prayerOfTheFaithful: `<h3>OraciÃ³n de los Fieles</h3><p class="liturgy-text">Hermanos, oremos a Dios Padre todopoderoso, que escucha siempre la oraciÃ³n de sus hijos. Digamos con fe:<br><strong>Te rogamos, Ã³yenos.</strong><br><em>(Se presentan las intenciones)</em><br>Escucha, Padre, nuestra oraciÃ³n y concÃ©denos aquellos dones que con fe te pedimos. Por Jesucristo, nuestro SeÃ±or.<br><strong>AmÃ©n.</strong></p>`,
                        eucharisticPrayerII: (preface) => `<h3>Plegaria EucarÃ­stica II</h3><p class="liturgy-text">El SeÃ±or estÃ© con ustedes.<br><strong>Y con tu espÃ­ritu.</strong><br>Levantemos el corazÃ³n.<br><strong>Lo tenemos levantado hacia el SeÃ±or.</strong><br>Demos gracias al SeÃ±or, nuestro Dios.<br><strong>Es justo y necesario.</strong></p><p class="liturgy-text">${preface}</p><p class="liturgy-text"><strong>Santo, Santo, Santo es el SeÃ±or, Dios del Universo. Llenos estÃ¡n el cielo y la tierra de tu gloria. Hosanna en el cielo. Bendito el que viene en nombre del SeÃ±or. Hosanna en el cielo.</strong></p><p class="liturgy-text">Santo eres en verdad, SeÃ±or, fuente de toda santidad; por eso te pedimos que santifiques estos dones con la efusiÃ³n de tu EspÃ­ritu, de manera que se conviertan para nosotros en el Cuerpo y la Sangre de Jesucristo, nuestro SeÃ±or. El cual, cuando iba a ser entregado a su PasiÃ³n, voluntariamente aceptada, tomÃ³ pan, dÃ¡ndote gracias, lo partiÃ³ y lo dio a sus discÃ­pulos, diciendo: <strong>Â«TOMEN Y COMAN TODOS DE Ã‰L, PORQUE ESTO ES MI CUERPO, QUE SERÃ ENTREGADO POR USTEDESÂ».</strong> Del mismo modo, acabada la cena, tomÃ³ el cÃ¡liz, y, dÃ¡ndote gracias de nuevo, lo pasÃ³ a sus discÃ­pulos, diciendo: <strong>Â«TOMEN Y BEBAN TODOS DE Ã‰L, PORQUE ESTE ES EL CÃLIZ DE MI SANGRE, SANGRE DE LA ALIANZA NUEVA Y ETERNA, QUE SERÃ DERRAMADA POR USTEDES Y POR MUCHOS PARA EL PERDÃ“N DE LOS PECADOS. HAGAN ESTO EN CONMEMORACIÃ“N MÃAÂ».</strong> Este es el Misterio de la fe.<br><strong>Anunciamos tu muerte, proclamamos tu resurrecciÃ³n. Â¡Ven, SeÃ±or JesÃºs!</strong></p><p class="liturgy-text">AsÃ­, pues, Padre, al celebrar ahora el memorial de la muerte y resurrecciÃ³n de tu Hijo, te ofrecemos el pan de vida y el cÃ¡liz de salvaciÃ³n, y te damos gracias porque nos haces dignos de servirte en tu presencia. Te pedimos humildemente que el EspÃ­ritu Santo congregue en la unidad a cuantos participamos del Cuerpo y la Sangre de Cristo. Por Cristo, con Ã©l y en Ã©l, a ti, Dios Padre omnipotente, en la unidad del EspÃ­ritu Santo, todo honor y toda gloria por los siglos de los siglos.<br><strong>AmÃ©n.</strong></p>`,
                        communionRite: `<h3>Rito de la ComuniÃ³n</h3><p class="liturgy-text">Fieles a la recomendaciÃ³n del Salvador y siguiendo su divina enseÃ±anza, nos atrevemos a decir:<br><strong>Padre nuestro, que estÃ¡s en el cielo, santificado sea tu Nombre; venga a nosotros tu reino; hÃ¡gase tu voluntad en la tierra como en el cielo. Danos hoy nuestro pan de cada dÃ­a; perdona nuestras ofensas, como tambiÃ©n nosotros perdonamos a los que nos ofenden; no nos dejes caer en la tentaciÃ³n, y lÃ­branos del mal.</strong><br>LÃ­branos de todos los males, SeÃ±or, y concÃ©denos la paz en nuestros dÃ­as, para que, ayudados por tu misericordia, vivamos siempre libres de pecado y protegidos de toda perturbaciÃ³n, mientras esperamos la gloriosa venida de nuestro Salvador Jesucristo.<br><strong>Tuyo es el reino, tuyo el poder y la gloria, por siempre, SeÃ±or.</strong><br>SeÃ±or Jesucristo, que dijiste a tus apÃ³stoles: Â«La paz les dejo, mi paz les doyÂ», no tengas en cuenta nossos pecados, sino la fe de tu Iglesia y, conforme a tu palabra, concÃ©dele la paz y la unidad. TÃº que vives y reinas por los siglos de los siglos.<br><strong>AmÃ©n.</strong><br>La paz del SeÃ±or estÃ© siempre con ustedes.<br><strong>Y con tu espÃ­ritu.</strong></p><p class="liturgy-text"><strong>Cordero de Dios, que quitas el pecado del mundo, ten piedad de nosotros.</strong><br><strong>Cordero de Dios, que quitas el pecado del mundo, ten piedad de nosotros.</strong><br><strong>Cordero de Dios, que quitas el pecado del mundo, danos la paz.</strong></p><p class="liturgy-text">Este es el Cordero de Dios, que quita el pecado del mundo. Dichosos los invitados a la cena del SeÃ±or.<br><strong>SeÃ±or, no soy digno de que entres en mi casa, pero una palabra tuya bastarÃ¡ para sanarme.</strong></p>`,
                        acnaPostCommunion: `<h3>OraciÃ³n despuÃ©s de la ComuniÃ³n (ACNA)</h3><p class="liturgy-text"><strong>Padre Celestial, te damos gracias por alimentarnos con el alimento espiritual del preciosÃ­simo Cuerpo y Sangre de tu Hijo nuestro Salvador Jesucristo; y por asegurarnos en estos santos misterios que somos miembros vivos de tu Hijo y herederos de tu reino eterno. Y te suplicamos, oh SeÃ±or, que nos asistas con tu gracia, para que continuemos en esa santa confraternidad, y hagamos todas las buenas obras que has preparado para que andemos en ellas; por Jesucristo nuestro SeÃ±or, a quien, contigo y el EspÃ­ritu Santo, sea todo honor y gloria, por los siglos de los siglos. AmÃ©n.</strong></p>`,
                        concludingRites: `<h3>Rito de ConclusiÃ³n</h3><p class="liturgy-text">El SeÃ±or estÃ© con ustedes.<br><strong>Y con tu espÃ­ritu.</strong><br>La bendiciÃ³n de Dios todopoderoso, Padre, Hijo, y EspÃ­ritu Santo, descienda sobre ustedes y permanezca para siempre.<br><strong>AmÃ©n.</strong><br>Pueden ir en paz.<br><strong>Demos gracias a Dios.</strong></p>`
                    };

                    const entranceProcession = `<h3>ProcesiÃ³n de Entrada</h3><p class="liturgy-text italic">(Se canta un himno o antÃ­fona de entrada apropiado)</p>`;
                    const introductoryRites = entranceProcession + templates.initialGreeting + templates.penitentialAct + (liturgy.omitGloria ? '' : templates.gloria) + `<h3>OraciÃ³n Colecta</h3><p class="liturgy-text">${liturgy.prayers.collect}</p>`;
                    
                    let psalmContentHtml = `<strong>R. ${liturgy.readings.psalm.response}</strong><br><br>` + liturgy.readings.psalm.stanzas.join(`<br><br><strong>R. ${liturgy.readings.psalm.response}</strong><br><br>`);

                    let gospelAcclamationHtml = liturgy.omitAlleluia ? templates.gospelAcclamation(liturgy.readings.gospelAcclamationVerse) : templates.alleluia(liturgy.readings.alleluiaVerse);

                    const liturgyOfTheWord = `<h3>Primera Lectura: ${liturgy.readings.firstReading.ref}</h3><p class="liturgy-text">${liturgy.readings.firstReading.text}</p><h3>Salmo Responsorial: ${liturgy.readings.psalm.ref}</h3><p class="liturgy-text">${psalmContentHtml}</p>${liturgy.readings.secondReading ? `<h3>Segunda Lectura: ${liturgy.readings.secondReading.ref}</h3><p class="liturgy-text">${liturgy.readings.secondReading.text}</p>` : ''}${gospelAcclamationHtml}${templates.gospel(liturgy.readings.gospel)}<h3>HomilÃ­a</h3><p class="liturgy-text italic">(ReflexiÃ³n sobre las lecturas)</p>${templates.credo}${templates.prayerOfTheFaithful}`;
                    
                    const liturgyOfTheEucharist = `<h3>PresentaciÃ³n de las Ofrendas</h3><p class="liturgy-text">Oren, hermanos, para que este sacrificio, mÃ­o y de ustedes, sea agradable a Dios, Padre todopoderoso.<br><strong>El SeÃ±or reciba de tus manos este sacrificio, para alabanza y gloria de su nombre, para nuestro bien y el de toda su santa Iglesia.</strong></p><h3>OraciÃ³n sobre las Ofrendas</h3><p class="liturgy-text">${liturgy.prayers.offerings}</p>${templates.eucharisticPrayerII(liturgy.prayers.preface)}${templates.communionRite}`;
                    
                    const concludingRites = `<h3>OraciÃ³n despuÃ©s de la ComuniÃ³n</h3><p class="liturgy-text">${liturgy.prayers.postCommunion}</p>${templates.acnaPostCommunion}${templates.concludingRites}`;

                    const finalHtml = `<div class="bg-white p-6 rounded-lg shadow-md">
                                        <div class="liturgy-section"><h2>Ritos Iniciales</h2>${introductoryRites}</div>
                                        <div class="liturgy-section"><h2>Liturgia de la Palabra</h2>${liturgyOfTheWord}</div>
                                        <div class="liturgy-section"><h2>Liturgia EucarÃ­stica</h2>${liturgyOfTheEucharist}</div>
                                        <div class="liturgy-section"><h2>Ritos de ConclusiÃ³n</h2>${concludingRites}</div>
                                    </div>`;

                    fullLiturgyUI.content.innerHTML = finalHtml;

                } else {
                    fullLiturgyUI.title.textContent = 'Liturgia no Disponible';
                    fullLiturgyUI.subtitle.textContent = date.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    fullLiturgyUI.content.innerHTML = `<div class="bg-white p-8 rounded-lg shadow-md text-center"><p class="text-gray-600 py-16">Lo sentimos, la liturgia completa para este dÃ­a aÃºn no ha sido implementada.</p></div>`;
                }
            }


            function hideFullLiturgy() {
                mainContent.classList.remove('hidden');
                fullLiturgyView.classList.add('hidden');
            }

            function loadLogoFromStorage() {
                const savedLogo = localStorage.getItem('userLogo');
                if (savedLogo) {
                    logoImage.src = savedLogo;
                }
            }

            // --- BIBLE NAVIGATION LOGIC ---
            function updateBibleView() {
                // Hide all views first
                Object.values(bibleViews).forEach(v => v.classList.add('hidden'));

                switch (bibleNavState.level) {
                    case 'testament':
                        bibleViews.book.innerHTML = '';
                        bibleData.forEach((book, index) => {
                            if (book.testament === bibleNavState.testament) {
                                const card = document.createElement('button');
                                card.className = 'bible-book-card text-center p-4 bg-white/70 backdrop-blur-sm rounded-lg shadow hover:bg-teal-100 border border-gray-200';
                                card.textContent = book.name;
                                card.dataset.bookIndex = index;
                                bibleViews.book.appendChild(card);
                            }
                        });
                        bibleHeader.title.textContent = bibleNavState.testament === 'OT' ? 'Antiguo Testamento' : 'Nuevo Testamento';
                        bibleViews.book.classList.remove('hidden');
                        bibleHeader.backBtn.classList.remove('hidden');
                        break;

                    case 'book':
                        const book = bibleData[bibleNavState.bookIndex];
                        bibleViews.chapter.innerHTML = '';
                        // Use book.chapters.length which is the correct number of chapters
                        for (let i = 1; i <= book.chapters.length; i++) {
                            const card = document.createElement('button');
                            card.className = 'bible-chapter-card flex items-center justify-center aspect-square p-2 bg-white/70 backdrop-blur-sm rounded-lg shadow hover:bg-teal-100 border border-gray-200';
                            card.textContent = i;
                            card.dataset.chapterIndex = i - 1;
                            bibleViews.chapter.appendChild(card);
                        }
                        bibleHeader.title.textContent = book.name;
                        bibleViews.chapter.classList.remove('hidden');
                        bibleHeader.backBtn.classList.remove('hidden');
                        break;

                    case 'chapter':
                        const bookData = bibleData[bibleNavState.bookIndex];
                        const chapterData = bookData.chapters[bibleNavState.chapterIndex];
                        bibleViews.content.innerHTML = ''; // Clear previous content
                        
                        chapterData.forEach((verse) => {
                            const p = document.createElement('p');
                            p.className = 'verse-wrapper';
                            if (verse.text.includes('ref-link')) {
                                p.classList.add('has-commentary');
                            }
                            p.innerHTML = `<sup>${verse.verse}</sup>${verse.text}`;
                            bibleViews.content.appendChild(p);
                        });

                        bibleHeader.title.textContent = `${bookData.name} ${bibleNavState.chapterIndex + 1}`;
                        bibleViews.content.classList.remove('hidden');
                        bibleHeader.backBtn.classList.remove('hidden');
                        break;

                    default: // root
                        bibleViews.testament.classList.remove('hidden');
                        bibleHeader.title.textContent = 'Biblia';
                        bibleHeader.backBtn.classList.add('hidden');
                        break;
                }
            }

            // --- THEOLOGY POPUP LOGIC ---
            function showTheologyPopup(event) {
                const refLink = event.target.closest('.ref-link');
                if (refLink) {
                    event.preventDefault();
                    event.stopPropagation();
                    const data = JSON.parse(refLink.dataset.term);
                    
                    let commentaryHtml = data.commentary ? `<hr class="my-3 border-gray-200"><h5 class="text-teal-700 font-bold mt-2">Comentario TeolÃ³gico</h5><p class="text-sm text-gray-600">${data.commentary}</p>` : '';

                    theologyPopupContent.innerHTML = `
                        <h5 class="text-teal-700 font-bold">${data.transliteration}</h5>
                        <p class="original-term text-gray-700 mb-2">${data.original}</p>
                        <p class="text-gray-800">${data.meaning}</p>
                        ${commentaryHtml}
                    `;
                    
                    theologyPopupOverlay.style.display = 'block';
                    theologyPopup.style.display = 'block';
                    document.body.style.overflow = 'hidden'; 
                }
            }
            
            function closeTheologyPopup() {
                theologyPopup.style.display = 'none';
                theologyPopupOverlay.style.display = 'none';
                document.body.style.overflow = ''; 
            }

            // --- EVENT LISTENERS ---
            Object.keys(mainNavButtons).forEach(key => {
                if(mainNavButtons[key]) {
                    mainNavButtons[key].addEventListener('click', () => switchView(key));
                }
            });

            backToCalendarBtn.addEventListener('click', hideFullLiturgy);
            printBtn.addEventListener('click', () => window.print());
            
            downloadDocxBtn.addEventListener('click', () => {
                const title = fullLiturgyUI.title.textContent;
                const subtitle = fullLiturgyUI.subtitle.textContent;
                const contentElement = document.getElementById('full-liturgy-content').cloneNode(true);

                contentElement.querySelectorAll('.ref-link').forEach(el => {
                    const sup = document.createElement('sup');
                    sup.textContent = el.textContent;
                    el.parentNode.replaceChild(sup, el);
                });

                const liturgyBody = contentElement.querySelector('.bg-white');
                if (!liturgyBody) return;

                const headerHtml = `...`; // Content omitted for brevity
                const twoColumnContent = `<div style="column-count: 2; column-gap: 40px;">${liturgyBody.innerHTML}</div>`;
                const fullHtmlForDocx = `...`; // Content omitted for brevity

                const converted = htmlDocx.asBlob(fullHtmlForDocx, {
                    orientation: 'landscape',
                    margins: { top: 720, right: 720, bottom: 720, left: 720 } 
                });
                saveAs(converted, `${title}.docx`);
            });
            
            cardsContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.liturgical-card');
                if (card && card.dataset.date) {
                    const [year, month, day] = card.dataset.date.split('-').map(Number);
                    const selectedDate = new Date(year, month - 1, day);
                    showFullLiturgy(selectedDate);
                }
            });

            // --- BIBLE EVENT LISTENERS ---
            bibleSelectors.selectOT.addEventListener('click', () => {
                bibleNavState.level = 'testament';
                bibleNavState.testament = 'OT';
                updateBibleView();
            });

            bibleSelectors.selectNT.addEventListener('click', () => {
                bibleNavState.level = 'testament';
                bibleNavState.testament = 'NT';
                updateBibleView();
            });

            bibleViews.book.addEventListener('click', (e) => {
                const card = e.target.closest('.bible-book-card');
                if (card) {
                    bibleNavState.level = 'book';
                    bibleNavState.bookIndex = parseInt(card.dataset.bookIndex);
                    updateBibleView();
                }
            });

            bibleViews.chapter.addEventListener('click', (e) => {
                const card = e.target.closest('.bible-chapter-card');
                if (card) {
                    bibleNavState.level = 'chapter';
                    bibleNavState.chapterIndex = parseInt(card.dataset.chapterIndex);
                    updateBibleView();
                }
            });

            bibleHeader.backBtn.addEventListener('click', () => {
                if (bibleNavState.level === 'chapter') {
                    bibleNavState.level = 'book';
                } else if (bibleNavState.level === 'book') {
                    bibleNavState.level = 'testament';
                } else if (bibleNavState.level === 'testament') {
                    bibleNavState.level = 'root';
                }
                updateBibleView();
            });

            // --- THEOLOGY POPUP LISTENERS ---
            fullLiturgyView.addEventListener('click', showTheologyPopup);
            bibleViews.content.addEventListener('click', showTheologyPopup);
            theologyPopupClose.addEventListener('click', closeTheologyPopup);
            theologyPopupOverlay.addEventListener('click', closeTheologyPopup);

            // --- LOGO UPLOAD LISTENERS ---
            uploadLogoBtn.addEventListener('click', () => logoUploader.click());

            logoUploader.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const logoDataUrl = e.target.result;
                        localStorage.setItem('userLogo', logoDataUrl);
                        logoImage.src = logoDataUrl;
                    }
                    reader.readAsDataURL(file);
                }
            });

            // --- HEADER SCROLL LOGIC ---
            let lastScrollTop = 0;
            const mainHeader = document.getElementById('main-header');
            window.addEventListener("scroll", function() {
                let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                if (scrollTop > lastScrollTop && scrollTop > mainHeader.offsetHeight) {
                    mainHeader.classList.add('header-hidden');
                } else {
                    mainHeader.classList.remove('header-hidden');
                }
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
            }, false);

            // --- MOBILE MENU LOGIC ---
            function openMobileMenu() {
                mobileMenu.classList.remove('menu-hidden');
                document.body.style.overflow = 'hidden';
            }

            function closeMobileMenu() {
                mobileMenu.classList.add('menu-hidden');
                document.body.style.overflow = '';
            }

            hamburgerBtn.addEventListener('click', openMobileMenu);
            closeMenuBtn.addEventListener('click', closeMobileMenu);
            mobileNavLinks.addEventListener('click', (e) => {
                if (e.target.matches('a.mobile-nav-link')) {
                    const view = e.target.dataset.view;
                    if (view) {
                        switchView(view);
                    }
                    closeMobileMenu();
                }
            });

            // --- INITIALIZATION ---
            function initializeApp() {
                setTimeout(() => {
                    splashScreen.classList.add('fade-out');
                    mainContent.classList.remove('opacity-0');
                    setTimeout(() => {
                        splashScreen.style.display = 'none';
                    }, 1500);
                }, 2000);

                loadLogoFromStorage();
                switchView('home');
                renderLiturgicalCards();
                updateBibleView(); // Initialize the bible view to its root state
            }
            initializeApp();
        });
    </script>
</body>
</html>
